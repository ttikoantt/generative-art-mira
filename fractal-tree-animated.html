<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Tree - Animated Growth</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        
        h1 {
            color: white;
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-align: center;
            padding: 0 20px;
        }
        
        .canvas-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 95vw;
            max-height: 70vh;
        }
        
        canvas {
            display: block;
            border-radius: 10px;
            max-width: 100%;
            max-height: 50vh;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            max-width: 95vw;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 10px;
            min-width: 120px;
        }
        
        .control-group label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .control-group input[type="range"] {
            width: 100px;
            cursor: pointer;
        }
        
        .control-group span {
            font-size: 14px;
            color: #333;
            font-weight: bold;
            margin-top: 3px;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .fullscreen-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂</button>
    
    <h1>üå≥ Fractal Tree Animation</h1>
    
    <div class="canvas-container">
        <canvas id="canvas"></canvas>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label>ÂàÜÂ≤êËßíÂ∫¶</label>
            <input type="range" id="angle" min="10" max="60" value="25">
            <span id="angleValue">25¬∞</span>
        </div>
        
        <div class="control-group">
            <label>Èï∑„Åï</label>
            <input type="range" id="length" min="50" max="150" value="100">
            <span id="lengthValue">100</span>
        </div>
        
        <div class="control-group">
            <label>ÊàêÈï∑ÈÄüÂ∫¶</label>
            <input type="range" id="speed" min="1" max="10" value="5">
            <span id="speedValue">5</span>
        </div>
        
        <div class="control-group">
            <label>Ê∑±„Åï</label>
            <input type="range" id="depth" min="5" max="12" value="9">
            <span id="depthValue">9</span>
        </div>
    </div>
    
    <div class="buttons">
        <button onclick="startGrowth()">üå± ÊàêÈï∑ÈñãÂßã</button>
        <button onclick="resetTree()">üîÑ „É™„Çª„ÉÉ„Éà</button>
        <button onclick="randomize()">üé≤ „É©„É≥„ÉÄ„É†</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫
        function resizeCanvas() {
            const container = canvas.parentElement;
            const maxWidth = Math.min(window.innerWidth * 0.95, 800);
            const maxHeight = Math.min(window.innerHeight * 0.5, 500);
            
            canvas.width = maxWidth;
            canvas.height = maxHeight;
            
            if (!isGrowing) {
                drawTree();
            }
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // „Éë„É©„É°„Éº„Çø
        let angle = 25;
        let length = 100;
        let speed = 5;
        let depth = 9;
        let growthProgress = 0;
        let isGrowing = false;
        let animationId = null;
        let hue = 0;
        
        // „Ç≥„É≥„Éà„É≠„Éº„É´„Ç§„Éô„É≥„Éà
        document.getElementById('angle').addEventListener('input', (e) => {
            angle = parseInt(e.target.value);
            document.getElementById('angleValue').textContent = angle + '¬∞';
            if (!isGrowing) drawTree();
        });
        
        document.getElementById('length').addEventListener('input', (e) => {
            length = parseInt(e.target.value);
            document.getElementById('lengthValue').textContent = length;
            if (!isGrowing) drawTree();
        });
        
        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = speed;
        });
        
        document.getElementById('depth').addEventListener('input', (e) => {
            depth = parseInt(e.target.value);
            document.getElementById('depthValue').textContent = depth;
            if (!isGrowing) drawTree();
        });
        
        // Ëâ≤Áõ∏„ÇíÊ∑±„Åï„Å´Âøú„Åò„Å¶Â§âÂåñ
        function getBranchColor(currentDepth, maxDepth) {
            const hueOffset = (maxDepth - currentDepth) * 15;
            const lightness = 30 + (currentDepth / maxDepth) * 20;
            return `hsl(${hue + hueOffset}, 70%, ${lightness}%)`;
        }
        
        // Êûù„ÇíÊèèÁîªÔºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂØæÂøúÔºâ
        function drawBranch(startX, startY, len, ang, currentDepth) {
            if (currentDepth > depth) return;
            
            const endX = startX + len * Math.sin(ang * Math.PI / 180);
            const endY = startY - len * Math.cos(ang * Math.PI / 180);
            
            // Êûù„ÅÆÂ§™„Åï„ÇíÊ∑±„Åï„Å´Âøú„Åò„Å¶Â§âÂåñ
            ctx.lineWidth = Math.max(1, (depth - currentDepth) * 0.8);
            ctx.strokeStyle = getBranchColor(currentDepth, depth);
            ctx.lineCap = 'round';
            
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            
            // Ëëâ„ÇíÊèèÁîªÔºàÊú´Á´Ø„ÅÆ„ÅøÔºâ
            if (currentDepth >= depth - 1) {
                ctx.fillStyle = `hsl(${hue + currentDepth * 10 + 120}, 80%, 50%)`;
                ctx.beginPath();
                ctx.arc(endX, endY, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ÊàêÈï∑„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠
            if (isGrowing) {
                const currentGrowth = Math.min(1, growthProgress / (depth * 2));
                if (currentGrowth * depth > currentDepth) {
                    const newLen = len * 0.7;
                    drawBranch(endX, endY, newLen, ang + angle, currentDepth + 1);
                    drawBranch(endX, endY, newLen, ang - angle, currentDepth + 1);
                }
            } else {
                const newLen = len * 0.7;
                drawBranch(endX, endY, newLen, ang + angle, currentDepth + 1);
                drawBranch(endX, endY, newLen, ang - angle, currentDepth + 1);
            }
        }
        
        // Êú®„ÇíÊèèÁîª
        function drawTree() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ËÉåÊôØ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            hue = (Date.now() / 50) % 360;
            
            const startX = canvas.width / 2;
            const startY = canvas.height - 50;
            
            drawBranch(startX, startY, length * (isGrowing ? Math.min(1, growthProgress) : 1), 0, 0);
        }
        
        // ÊàêÈï∑„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        function animateGrowth() {
            growthProgress += speed * 0.01;
            
            drawTree();
            
            if (growthProgress < depth * 2) {
                animationId = requestAnimationFrame(animateGrowth);
            } else {
                isGrowing = false;
                growthProgress = 0;
            }
        }
        
        function startGrowth() {
            if (isGrowing) return;
            
            isGrowing = true;
            growthProgress = 0;
            hue = 0;
            
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            animateGrowth();
        }
        
        function resetTree() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            isGrowing = false;
            growthProgress = 0;
            drawTree();
        }
        
        function randomize() {
            angle = Math.random() * 40 + 15;
            length = Math.random() * 80 + 60;
            depth = Math.floor(Math.random() * 5) + 7;
            
            document.getElementById('angle').value = angle;
            document.getElementById('angleValue').textContent = Math.round(angle) + '¬∞';
            document.getElementById('length').value = length;
            document.getElementById('lengthValue').textContent = Math.round(length);
            document.getElementById('depth').value = depth;
            document.getElementById('depthValue').textContent = depth;
            
            startGrowth();
        }
        
        // ÂÖ®ÁîªÈù¢Ë°®Á§∫
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // ÂàùÊúüÊèèÁîª
        drawTree();
        
        // ÂÆöÊúüÁöÑ„Å´Ëâ≤Áõ∏„ÇíÂ§âÂåñ
        setInterval(() => {
            if (!isGrowing) {
                drawTree();
            }
        }, 100);
    </script>
</body>
</html>
