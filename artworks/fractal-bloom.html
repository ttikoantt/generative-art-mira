<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Bloom - Mira</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: #0f0;
            font-size: 12px;
            z-index: 100;
            border: 1px solid #0f0;
        }

        .controls h1 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #0ff;
        }

        .controls p {
            margin: 5px 0;
        }

        .btn {
            background: transparent;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 8px 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #0f0;
            color: #000;
        }

        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid #0ff;
            color: #0ff;
            padding: 15px 25px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-radius: 10px;
            transition: all 0.3s;
            z-index: 100;
        }

        .fullscreen-btn:hover {
            background: #0ff;
            color: #000;
            transform: scale(1.05);
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            color: #0ff;
            font-size: 11px;
            border: 1px solid #0ff;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h1>üå∏ Fractal Bloom</h1>
        <p>„ÇØ„É™„ÉÉ„ÇØ„ÅßËä±„ÇíÂí≤„Åã„Åõ„Çà„ÅÜÔºÅ</p>
        <p>„Éâ„É©„ÉÉ„Ç∞„ÅßÈÄ£Á∂öÁîüÊàê</p>
        <button class="btn" onclick="clearCanvas()">„ÇØ„É™„Ç¢</button>
        <button class="btn" onclick="randomBloom()">„É©„É≥„ÉÄ„É†ÁîüÊàê</button>
    </div>

    <div class="info">
        Bloom Count: <span id="count">0</span>
    </div>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂ ÂÖ®ÁîªÈù¢</button>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let bloomCount = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resize);
        resize();

        // HSV to RGB conversion
        function hsvToRgb(h, s, v) {
            let r, g, b;
            const i = Math.floor(h * 6);
            const f = h * 6 - i;
            const p = v * (1 - s);
            const q = v * (1 - f * s);
            const t = v * (1 - (1 - f) * s);

            switch (i % 6) {
                case 0: r = v; g = t; b = p; break;
                case 1: r = q; g = v; b = p; break;
                case 2: r = p; g = v; b = t; break;
                case 3: r = p; g = q; b = v; break;
                case 4: r = t; g = p; b = v; break;
                case 5: r = v; g = p; b = q; break;
            }

            return [Math.floor(r * 255), Math.floor(g * 255), Math.floor(b * 255)];
        }

        // Draw fractal bloom
        function drawBloom(x, y, size, angle, depth, hue) {
            if (depth === 0 || size < 2) return;

            const endX = x + Math.cos(angle) * size;
            const endY = y + Math.sin(angle) * size;

            // Draw petal with gradient
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
            const [r, g, b] = hsvToRgb((hue + depth * 0.1) % 1, 0.8, 1);
            const [r2, g2, b2] = hsvToRgb((hue + depth * 0.1 + 0.2) % 1, 0.6, 0.8);

            gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, ${0.8})`);
            gradient.addColorStop(1, `rgba(${r2}, ${g2}, ${b2}, 0)`);

            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.quadraticCurveTo(
                x + Math.cos(angle + Math.PI / 4) * size / 2,
                y + Math.sin(angle + Math.PI / 4) * size / 2,
                endX,
                endY
            );
            ctx.strokeStyle = gradient;
            ctx.lineWidth = size / 5;
            ctx.lineCap = 'round';
            ctx.stroke();

            // Recursive branches
            const branches = 3 + Math.floor(Math.random() * 3);
            for (let i = 0; i < branches; i++) {
                const newAngle = angle + (Math.random() - 0.5) * Math.PI / 2;
                const newSize = size * (0.5 + Math.random() * 0.3);
                drawBloom(endX, endY, newSize, newAngle, depth - 1, hue + 0.05);
            }
        }

        // Create bloom
        function createBloom(x, y) {
            const hue = Math.random();
            const initialSize = 50 + Math.random() * 50;
            const depth = 5 + Math.floor(Math.random() * 3);

            // Animate bloom growth
            let currentDepth = 1;
            const growInterval = setInterval(() => {
                if (currentDepth > depth) {
                    clearInterval(growInterval);
                    return;
                }
                drawBloom(x, y, initialSize, -Math.PI / 2, currentDepth, hue);
                currentDepth++;
            }, 100);

            bloomCount++;
            document.getElementById('count').textContent = bloomCount;
        }

        // Clear canvas
        function clearCanvas() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            bloomCount = 0;
            document.getElementById('count').textContent = bloomCount;
        }

        // Random bloom
        function randomBloom() {
            const x = Math.random() * width;
            const y = Math.random() * height;
            createBloom(x, y);
        }

        // Mouse events
        let isMouseDown = false;

        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            createBloom(e.clientX, e.clientY);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                createBloom(e.clientX, e.clientY);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        // Touch events
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            createBloom(touch.clientX, touch.clientY);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            createBloom(touch.clientX, touch.clientY);
        });

        // Fullscreen toggle
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Initial bloom
        setTimeout(() => {
            createBloom(width / 2, height / 2);
        }, 500);
    </script>
</body>
</html>
