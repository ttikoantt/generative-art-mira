<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>„Éï„É©„ÇØ„Çø„É´„Éª„Ç¨„Éº„Éá„É≥ | Fractal Garden</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            touch-action: none;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 14px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 300px;
        }

        .info h2 {
            font-size: 18px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .param {
            margin: 5px 0;
            font-size: 12px;
            color: #aaa;
        }

        .param span {
            color: #fff;
            font-weight: bold;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .fullscreen-btn:hover {
            background: rgba(102, 126, 234, 0.5);
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .controls {
                width: 90%;
                padding: 12px 20px;
                gap: 10px;
            }

            .btn {
                padding: 8px 15px;
                font-size: 12px;
            }

            .info {
                top: 80px;
                left: 10px;
                right: 10px;
                max-width: none;
                font-size: 12px;
            }

            .fullscreen-btn {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <canvas id="fractal"></canvas>

        <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂</button>

        <div class="info">
            <h2>üå∏ „Éï„É©„ÇØ„Çø„É´„Éª„Ç¨„Éº„Éá„É≥</h2>
            <div class="param">C = <span id="cValue">-0.7 + 0.27015i</span></div>
            <div class="param">Zoom: <span id="zoomValue">1.0x</span></div>
            <div class="param">„Éâ„É©„ÉÉ„Ç∞/„Çπ„ÉØ„Ç§„Éó„ÅßÊé¢Á¥¢</div>
        </div>

        <div class="controls">
            <button class="btn" onclick="randomize()">üé≤ „É©„É≥„ÉÄ„É†</button>
            <button class="btn" onclick="reset()">üîÑ „É™„Çª„ÉÉ„Éà</button>
            <button class="btn" onclick="saveImage()">üì∏ ‰øùÂ≠ò</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('fractal');
        const ctx = canvas.getContext('2d');

        let width, height;
        let cRe = -0.7;
        let cIm = 0.27015;
        let zoom = 1.0;
        let offsetX = 0;
        let offsetY = 0;
        let maxIter = 100;

        // Ëâ≤„Éë„É¨„ÉÉ„Éà
        const colors = [];
        for (let i = 0; i < maxIter; i++) {
            const hue = (i * 3.6 + 200) % 360;
            const sat = 70 + Math.sin(i * 0.1) * 20;
            const light = 40 + Math.sin(i * 0.2) * 20;
            colors.push(`hsl(${hue}, ${sat}%, ${light}%)`);
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            draw();
        }

        function draw() {
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;

            for (let px = 0; px < width; px++) {
                for (let py = 0; py < height; py++) {
                    const x = (px - width / 2) / (0.3 * Math.min(width, height) * zoom) + offsetX;
                    const y = (py - height / 2) / (0.3 * Math.min(width, height) * zoom) + offsetY;

                    let zx = x;
                    let zy = y;
                    let iter = 0;

                    while (zx * zx + zy * zy < 4 && iter < maxIter) {
                        const xtemp = zx * zx - zy * zy + cRe;
                        zy = 2 * zx * zy + cIm;
                        zx = xtemp;
                        iter++;
                    }

                    const idx = (py * width + px) * 4;

                    if (iter === maxIter) {
                        data[idx] = 0;
                        data[idx + 1] = 0;
                        data[idx + 2] = 0;
                        data[idx + 3] = 255;
                    } else {
                        const color = colors[iter];
                        const match = color.match(/\d+/g);
                        const [h, s, l] = match;

                        // HSL to RGB
                        const h2 = h / 360;
                        const s2 = s / 100;
                        const l2 = l / 100;

                        const hue2rgb = (p, q, t) => {
                            if (t < 0) t += 1;
                            if (t > 1) t -= 1;
                            if (t < 1/6) return p + (q - p) * 6 * t;
                            if (t < 1/2) return q;
                            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                            return p;
                        };

                        const q = l2 < 0.5 ? l2 * (1 + s2) : l2 + s2 - l2 * s2;
                        const p = 2 * l2 - q;

                        data[idx] = hue2rgb(p, q, h2 + 1/3) * 255;
                        data[idx + 1] = hue2rgb(p, q, h2) * 255;
                        data[idx + 2] = hue2rgb(p, q, h2 - 1/3) * 255;
                        data[idx + 3] = 255;
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);
            updateInfo();
        }

        function updateInfo() {
            document.getElementById('cValue').textContent =
                `${cRe.toFixed(5)} + ${cIm.toFixed(5)}i`;
            document.getElementById('zoomValue').textContent = `${zoom.toFixed(2)}x`;
        }

        function randomize() {
            cRe = (Math.random() - 0.5) * 2;
            cIm = (Math.random() - 0.5) * 2;
            zoom = 1.0;
            offsetX = 0;
            offsetY = 0;

            // Êñ∞„Åó„ÅÑËâ≤„Éë„É¨„ÉÉ„ÉàÁîüÊàê
            colors.length = 0;
            const baseHue = Math.random() * 360;
            for (let i = 0; i < maxIter; i++) {
                const hue = (baseHue + i * 3.6) % 360;
                const sat = 70 + Math.sin(i * 0.1) * 20;
                const light = 40 + Math.sin(i * 0.2) * 20;
                colors.push(`hsl(${hue}, ${sat}%, ${light}%)`);
            }

            draw();
        }

        function reset() {
            cRe = -0.7;
            cIm = 0.27015;
            zoom = 1.0;
            offsetX = 0;
            offsetY = 0;
            draw();
        }

        function saveImage() {
            const link = document.createElement('a');
            link.download = `fractal-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // „Éâ„É©„ÉÉ„Ç∞Êìç‰Ωú
        let isDragging = false;
        let lastX, lastY;

        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const dx = e.clientX - lastX;
            const dy = e.clientY - lastY;

            offsetX -= dx / (0.3 * Math.min(width, height) * zoom);
            offsetY -= dy / (0.3 * Math.min(width, height) * zoom);

            lastX = e.clientX;
            lastY = e.clientY;

            draw();
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        // „Çø„ÉÉ„ÉÅÊìç‰Ωú
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDragging = true;
            lastX = e.touches[0].clientX;
            lastY = e.touches[0].clientY;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isDragging) return;

            const dx = e.touches[0].clientX - lastX;
            const dy = e.touches[0].clientY - lastY;

            offsetX -= dx / (0.3 * Math.min(width, height) * zoom);
            offsetY -= dy / (0.3 * Math.min(width, height) * zoom);

            lastX = e.touches[0].clientX;
            lastY = e.touches[0].clientY;

            draw();
        });

        canvas.addEventListener('touchend', () => isDragging = false);

        // „Éõ„Ç§„Éº„É´„Åß„Ç∫„Éº„É†
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
            zoom *= zoomFactor;
            zoom = Math.max(0.1, Math.min(zoom, 1000));
            draw();
        });

        window.addEventListener('resize', resize);
        resize();
    </script>
</body>
</html>