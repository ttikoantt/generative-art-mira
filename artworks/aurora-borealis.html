<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora Borealis - オーロラ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a1a;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        canvas {
            display: block;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            color: white;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 12px;
            opacity: 0.8;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin: 2px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn.active {
            background: rgba(100, 200, 255, 0.5);
        }

        .slider-container {
            margin: 10px 0;
        }

        .slider-container input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(100, 200, 255, 0.8);
            cursor: pointer;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div class="controls">
        <div class="control-group">
            <label>カラーパレット</label>
            <button class="btn active" data-palette="0">グリーンオーロラ</button>
            <button class="btn" data-palette="1">パープルオーロラ</button>
            <button class="btn" data-palette="2">レインボーオーロラ</button>
        </div>

        <div class="control-group">
            <label>波の速度</label>
            <div class="slider-container">
                <input type="range" id="speed" min="0.1" max="2" step="0.1" value="0.5">
            </div>
        </div>

        <div class="control-group">
            <label>波の高さ</label>
            <div class="slider-container">
                <input type="range" id="amplitude" min="50" max="200" step="10" value="100">
            </div>
        </div>

        <div class="control-group">
            <label>オプション</label>
            <button class="btn" id="toggleStars">★ 星: ON</button>
            <button class="btn" id="toggleGlow">✨ グロー: ON</button>
        </div>
    </div>

    <button class="fullscreen-btn" id="fullscreen">全画面</button>

    <div class="info">Aurora Borealis - オーロラ</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // 設定
        let config = {
            palette: 0,
            speed: 0.5,
            amplitude: 100,
            showStars: true,
            showGlow: true
        };

        // カラーパレット
        const palettes = [
            { name: 'グリーンオーロラ', colors: ['#00ff87', '#00d4ff', '#0099ff', '#00ff66', '#00cc99'] },
            { name: 'パープルオーロラ', colors: ['#9b59b6', '#8e44ad', '#6c3483', '#bb8fce', '#af7ac5'] },
            { name: 'レインボーオーロラ', colors: ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff'] }
        ];

        // 星
        let stars = [];

        // オーロラの波
        let waves = [];
        const numWaves = 8;

        // 時間
        let time = 0;

        // 初期化
        function init() {
            resize();
            initStars();
            initWaves();
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function initStars() {
            stars = [];
            const numStars = 200;
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height * 0.6,
                    size: Math.random() * 2 + 0.5,
                    brightness: Math.random(),
                    twinkleSpeed: Math.random() * 0.02 + 0.01
                });
            }
        }

        function initWaves() {
            waves = [];
            for (let i = 0; i < numWaves; i++) {
                waves.push({
                    y: canvas.height * 0.3 + (i * canvas.height * 0.1),
                    offset: i * 0.5,
                    frequency: 0.002 + Math.random() * 0.002,
                    phase: Math.random() * Math.PI * 2,
                    opacity: 0.3 + Math.random() * 0.4,
                    colorIndex: Math.floor(Math.random() * 5)
                });
            }
        }

        // Perlin風ノイズ関数（簡易版）
        function noise(x, y) {
            const n = Math.sin(x * 12.9898 + y * 78.233) * 43758.5453;
            return n - Math.floor(n);
        }

        // 平滑ノイズ
        function smoothNoise(x, y) {
            const x0 = Math.floor(x);
            const y0 = Math.floor(y);
            const fx = x - x0;
            const fy = y - y0;

            const v00 = noise(x0, y0);
            const v10 = noise(x0 + 1, y0);
            const v01 = noise(x0, y0 + 1);
            const v11 = noise(x0 + 1, y0 + 1);

            const i1 = v00 * (1 - fx) + v10 * fx;
            const i2 = v01 * (1 - fx) + v11 * fx;

            return i1 * (1 - fy) + i2 * fy;
        }

        // 星を描画
        function drawStars() {
            if (!config.showStars) return;

            stars.forEach(star => {
                star.brightness += star.twinkleSpeed;
                if (star.brightness > 1 || star.brightness < 0.2) {
                    star.twinkleSpeed *= -1;
                }

                const alpha = Math.abs(star.brightness);
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // オーロラを描画
        function drawAurora() {
            const palette = palettes[config.palette];

            waves.forEach((wave, waveIndex) => {
                ctx.save();

                if (config.showGlow) {
                    ctx.shadowBlur = 30;
                    ctx.shadowColor = palette.colors[wave.colorIndex];
                }

                ctx.globalAlpha = wave.opacity;
                ctx.strokeStyle = palette.colors[wave.colorIndex];
                ctx.lineWidth = 3;

                ctx.beginPath();

                for (let x = 0; x <= canvas.width; x += 5) {
                    const baseY = wave.y;
                    const waveOffset = wave.offset + time * config.speed;
                    const freq = wave.frequency;

                    // 複数の正弦波を重ねて有機的な動きに
                    let yOffset = 0;
                    yOffset += Math.sin(x * freq + waveOffset) * config.amplitude * 0.5;
                    yOffset += Math.sin(x * freq * 2 + waveOffset * 1.3) * config.amplitude * 0.3;
                    yOffset += Math.sin(x * freq * 0.5 + waveOffset * 0.7) * config.amplitude * 0.2;

                    // ノイズを加えて不規則性を追加
                    const noiseVal = (smoothNoise(x * 0.01, waveIndex + time * 0.1) - 0.5) * 50;
                    yOffset += noiseVal;

                    const y = baseY + yOffset;

                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }

                ctx.stroke();

                // カーテン効果（下に垂れる線）
                for (let x = 0; x <= canvas.width; x += 30) {
                    const baseY = wave.y;
                    const waveOffset = wave.offset + time * config.speed;
                    const freq = wave.frequency;

                    let yOffset = 0;
                    yOffset += Math.sin(x * freq + waveOffset) * config.amplitude * 0.5;
                    yOffset += Math.sin(x * freq * 2 + waveOffset * 1.3) * config.amplitude * 0.3;

                    const noiseVal = (smoothNoise(x * 0.01, waveIndex + time * 0.1) - 0.5) * 50;
                    yOffset += noiseVal;

                    const startY = baseY + yOffset;
                    const curtainLength = 50 + Math.random() * 100;

                    ctx.globalAlpha = wave.opacity * 0.3;
                    ctx.beginPath();
                    ctx.moveTo(x, startY);

                    // カーテンが揺れる動き
                    const sway = Math.sin(time * 2 + x * 0.02) * 20;
                    ctx.lineTo(x + sway, startY + curtainLength);

                    ctx.stroke();
                }

                ctx.restore();
            });
        }

        // 背景グラデーション
        function drawBackground() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(0.5, '#0f1429');
            gradient.addColorStop(1, '#1a1a2e');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // アニメーションループ
        function animate() {
            drawBackground();
            drawStars();
            drawAurora();

            time += 0.016;
            requestAnimationFrame(animate);
        }

        // イベントリスナー
        window.addEventListener('resize', () => {
            resize();
            initStars();
            initWaves();
        });

        // パレットボタン
        document.querySelectorAll('[data-palette]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-palette]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                config.palette = parseInt(btn.dataset.palette);
            });
        });

        // スライダー
        document.getElementById('speed').addEventListener('input', (e) => {
            config.speed = parseFloat(e.target.value);
        });

        document.getElementById('amplitude').addEventListener('input', (e) => {
            config.amplitude = parseFloat(e.target.value);
        });

        // トグルボタン
        document.getElementById('toggleStars').addEventListener('click', (e) => {
            config.showStars = !config.showStars;
            e.target.textContent = `★ 星: ${config.showStars ? 'ON' : 'OFF'}`;
        });

        document.getElementById('toggleGlow').addEventListener('click', (e) => {
            config.showGlow = !config.showGlow;
            e.target.textContent = `✨ グロー: ${config.showGlow ? 'ON' : 'OFF'}`;
        });

        // 全画面
        document.getElementById('fullscreen').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // タッチ操作対応
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        // 開始
        init();
        animate();
    </script>
</body>
</html>
