<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Flow - ÊµÅ‰Ωì„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            width: 100%;
            max-width: 100%;
        }

        h1 {
            font-size: clamp(1.5rem, 5vw, 3rem);
            text-align: center;
            background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }

        .canvas-container {
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        canvas {
            display: block;
            background: radial-gradient(circle at center, #1a1a2e 0%, #0c0c0c 100%);
            cursor: crosshair;
            max-width: 100%;
            height: auto;
            touch-action: none;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            width: 100%;
            max-width: 600px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
        }

        label {
            font-size: 0.8rem;
            color: #aaa;
        }

        input[type="range"] {
            width: 120px;
            accent-color: #00ffff;
        }

        button {
            background: linear-gradient(135deg, #00ffff 0%, #0099ff 100%);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        button:active {
            transform: scale(0.95);
        }

        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding: 0;
            font-size: 1.5rem;
            z-index: 1000;
        }

        .stats {
            font-size: 0.75rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .canvas-container {
                width: 100%;
            }

            canvas {
                width: 100%;
                height: auto;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            input[type="range"] {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä Particle Flow</h1>

        <div class="canvas-container">
            <canvas id="canvas" width="800" height="600"></canvas>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Á≤íÂ≠êÊï∞: <span id="particleCountLabel">300</span></label>
                <input type="range" id="particleCount" min="100" max="800" value="300">
            </div>

            <div class="control-group">
                <label>ÊµÅ„Çå„ÅÆÂº∑„Åï: <span id="flowStrengthLabel">5</span></label>
                <input type="range" id="flowStrength" min="1" max="10" value="5">
            </div>

            <div class="control-group">
                <label>Ëâ≤„ÅÆÂ§âÂåñÈÄüÂ∫¶: <span id="colorSpeedLabel">1</span></label>
                <input type="range" id="colorSpeed" min="0.1" max="3" value="1" step="0.1">
            </div>

            <button id="resetBtn">„É™„Çª„ÉÉ„Éà</button>
            <button id="modeBtn">„É¢„Éº„ÉâÂàáÊõø</button>
        </div>

        <div class="stats" id="stats">FPS: 60 | Á≤íÂ≠ê: 300</div>
    </div>

    <button class="fullscreen-btn" id="fullscreenBtn">‚õ∂</button>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // „Éë„É©„É°„Éº„Çø
        let particleCount = 300;
        let flowStrength = 5;
        let colorSpeed = 1;
        let mode = 0; // 0: Ê∏¶, 1: Ê≥¢, 2: „É©„É≥„ÉÄ„É†
        const modes = ['Ê∏¶„É¢„Éº„Éâ', 'Ê≥¢„É¢„Éº„Éâ', '„É©„É≥„ÉÄ„É†„É¢„Éº„Éâ'];

        // Á≤íÂ≠ê„ÇØ„É©„Çπ
        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = 0;
                this.vy = 0;
                this.size = Math.random() * 2 + 1;
                this.hue = Math.random() * 360;
                this.alpha = Math.random() * 0.5 + 0.5;
            }

            update(time) {
                // „É¢„Éº„Éâ„Å´Âøú„Åò„ÅüÊµÅ„ÇåÂ†¥„ÅÆË®àÁÆó
                let targetVx, targetVy;

                if (mode === 0) {
                    // Ê∏¶„É¢„Éº„Éâ
                    const centerX = width / 2;
                    const centerY = height / 2;
                    const dx = this.x - centerX;
                    const dy = this.y - centerY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const angle = Math.atan2(dy, dx);
                    const tangentAngle = angle + Math.PI / 2;

                    targetVx = Math.cos(tangentAngle) * flowStrength * 0.5;
                    targetVy = Math.sin(tangentAngle) * flowStrength * 0.5;

                    // ‰∏≠ÂøÉ„Å´Â∞ë„ÅóÂºï„ÅçÂØÑ„Åõ„Çã
                    targetVx += -dx * 0.001 * flowStrength;
                    targetVy += -dy * 0.001 * flowStrength;

                } else if (mode === 1) {
                    // Ê≥¢„É¢„Éº„Éâ
                    const waveX = Math.sin(this.y * 0.01 + time * 0.001) * flowStrength;
                    const waveY = Math.cos(this.x * 0.01 + time * 0.001) * flowStrength * 0.5;

                    targetVx = waveX;
                    targetVy = waveY;

                } else {
                    // „É©„É≥„ÉÄ„É†„É¢„Éº„Éâ
                    const noiseX = Math.sin(this.x * 0.005 + time * 0.0005) * Math.cos(this.y * 0.005);
                    const noiseY = Math.cos(this.x * 0.005) * Math.sin(this.y * 0.005 + time * 0.0005);

                    targetVx = noiseX * flowStrength;
                    targetVy = noiseY * flowStrength;
                }

                // ÈÄüÂ∫¶„ÅÆÂπ≥ÊªëÂåñ
                this.vx += (targetVx - this.vx) * 0.1;
                this.vy += (targetVy - this.vy) * 0.1;

                // ‰ΩçÁΩÆ„ÅÆÊõ¥Êñ∞
                this.x += this.vx;
                this.y += this.vy;

                // Ëâ≤„ÅÆÊõ¥Êñ∞
                this.hue += 0.5 * colorSpeed;

                // Â¢ÉÁïåÂá¶ÁêÜÔºà„É©„ÉÉ„Éî„É≥„Ç∞Ôºâ
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
                if (this.y < 0) this.y = height;
                if (this.y > height) this.y = 0;
            }

            draw() {
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, 0,
                    this.x, this.y, this.size * 3
                );
                gradient.addColorStop(0, `hsla(${this.hue}, 100%, 60%, ${this.alpha})`);
                gradient.addColorStop(0.5, `hsla(${this.hue}, 100%, 50%, ${this.alpha * 0.5})`);
                gradient.addColorStop(1, `hsla(${this.hue}, 100%, 40%, 0)`);

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 3, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
            }
        }

        // Á≤íÂ≠êÈÖçÂàó„ÅÆÂàùÊúüÂåñ
        let particles = [];

        function initParticles() {
            particles = [];
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
        }

        initParticles();

        // FPSË®àÁÆó
        let fps = 60;
        let lastTime = performance.now();
        let frames = 0;
        let fpsUpdateTime = 0;

        // „É°„Ç§„É≥„É´„Éº„Éó
        function animate(time) {
            // FPSË®àÁÆó
            frames++;
            const deltaTime = time - lastTime;

            if (time - fpsUpdateTime > 1000) {
                fps = Math.round(frames * 1000 / (time - fpsUpdateTime));
                frames = 0;
                fpsUpdateTime = time;
                document.getElementById('stats').textContent = `FPS: ${fps} | Á≤íÂ≠ê: ${particleCount} | „É¢„Éº„Éâ: ${modes[mode]}`;
            }

            // ËÉåÊôØ„ÇíÂçäÈÄèÊòé„Åß„ÇØ„É™„Ç¢Ôºà„Éà„É¨„Ç§„É´ÂäπÊûúÔºâ
            ctx.fillStyle = 'rgba(12, 12, 12, 0.1)';
            ctx.fillRect(0, 0, width, height);

            // Á≤íÂ≠ê„ÅÆÊõ¥Êñ∞„Å®ÊèèÁîª
            particles.forEach(particle => {
                particle.update(time);
                particle.draw();
            });

            // Êé•Á∂öÁ∑ö„ÅÆÊèèÁîªÔºàËøë„ÅÑÁ≤íÂ≠êÂêåÂ£´Ôºâ
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 0.5;
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 80) {
                        const alpha = (1 - dist / 80) * 0.1;
                        ctx.strokeStyle = `rgba(255, 255, 255, ${alpha})`;
                        ctx.beginPath();
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }

            lastTime = time;
            requestAnimationFrame(animate);
        }

        // „Éû„Ç¶„Çπ/„Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà
        let mouseX = width / 2;
        let mouseY = height / 2;

        function updateMousePosition(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            if (e.touches) {
                mouseX = (e.touches[0].clientX - rect.left) * scaleX;
                mouseY = (e.touches[0].clientY - rect.top) * scaleY;
            } else {
                mouseX = (e.clientX - rect.left) * scaleX;
                mouseY = (e.clientY - rect.top) * scaleY;
            }

            // Ëøë„Åè„ÅÆÁ≤íÂ≠ê„Å´ÂΩ±Èüø„Çí‰∏é„Åà„Çã
            particles.forEach(particle => {
                const dx = particle.x - mouseX;
                const dy = particle.y - mouseY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < 150) {
                    const force = (1 - dist / 150) * 2;
                    particle.vx += (dx / dist) * force;
                    particle.vy += (dy / dist) * force;
                }
            });
        }

        canvas.addEventListener('mousemove', updateMousePosition);
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            updateMousePosition(e);
        });

        // „Ç≥„É≥„Éà„É≠„Éº„É´„Ç§„Éô„É≥„Éà
        document.getElementById('particleCount').addEventListener('input', (e) => {
            particleCount = parseInt(e.target.value);
            document.getElementById('particleCountLabel').textContent = particleCount;
            initParticles();
        });

        document.getElementById('flowStrength').addEventListener('input', (e) => {
            flowStrength = parseInt(e.target.value);
            document.getElementById('flowStrengthLabel').textContent = flowStrength;
        });

        document.getElementById('colorSpeed').addEventListener('input', (e) => {
            colorSpeed = parseFloat(e.target.value);
            document.getElementById('colorSpeedLabel').textContent = colorSpeed;
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            initParticles();
        });

        document.getElementById('modeBtn').addEventListener('click', () => {
            mode = (mode + 1) % modes.length;
        });

        // „Éï„É´„Çπ„ÇØ„É™„Éº„É≥
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            if (canvas.requestFullscreen) {
                canvas.requestFullscreen();
            } else if (canvas.webkitRequestFullscreen) {
                canvas.webkitRequestFullscreen();
            } else if (canvas.msRequestFullscreen) {
                canvas.msRequestFullscreen();
            }
        });

        // „Çπ„Éö„Éº„Çπ„Ç≠„Éº„Åß„É¢„Éº„ÉâÂàáÊõø
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                mode = (mode + 1) % modes.length;
            }
        });

        // ÈñãÂßã
        requestAnimationFrame(animate);
    </script>
</body>
</html>
