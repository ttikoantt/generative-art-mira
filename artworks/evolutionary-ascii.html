<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolutionary ASCII - Generative Art Collection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 100%);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info {
            text-align: center;
            max-width: 800px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .ascii-display {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            overflow-x: auto;
        }

        #ascii-canvas {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.2;
            white-space: pre;
            color: #00ff00;
        }

        .stats {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        .back-link {
            margin-top: 40px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #764ba2;
        }

        .progress {
            width: 100%;
            max-width: 800px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>ğŸ§¬ Evolutionary ASCII</h1>
    <p class="subtitle">é€²åŒ–çš„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ç¾ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é€²åŒ–ã•ã›ã‚‹</p>

    <div class="info">
        <p>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ»ã‚¢ãƒ‹ãƒ¼ãƒªãƒ³ã‚°ã‚’ä½¿ã£ã¦ã€</p>
        <p>ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—ã®ä¸¦ã³ã‹ã‚‰å¯¾ç§°çš„ã§ç¾ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é€²åŒ–ã•ã›ã¾ã™ã€‚</p>
        <p>ä½•ç™¾ä¸–ä»£ã‚‚ã®é€²åŒ–ã‚’é€šã˜ã¦ã€ã‚¢ãƒ¼ãƒˆãŒç”Ÿã¾ã‚Œã¾ã™ã€‚</p>
    </div>

    <div class="controls">
        <button id="startBtn">ğŸš€ é€²åŒ–é–‹å§‹</button>
        <button id="stepBtn">ğŸ‘£ 1ä¸–ä»£é€²åŒ–</button>
        <button id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="progress">
        <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-value" id="generation">0</div>
            <div class="stat-label">ä¸–ä»£</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="best-score">0</div>
            <div class="stat-label">ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="temperature">1.00</div>
            <div class="stat-label">æ¸©åº¦</div>
        </div>
    </div>

    <div class="ascii-display">
        <pre id="ascii-canvas"></pre>
    </div>

    <a href="../index.html" class="back-link">â† æˆ»ã‚‹</a>

    <script>
        // ASCIIæ–‡å­—ã‚»ãƒƒãƒˆ
        const ASCII_CHARS = " .:-=+*#%@XO";

        class EvolutionaryASCII {
            constructor(width = 50, height = 25) {
                this.width = width;
                this.height = height;
                this.grid = [];
                this.bestScore = -Infinity;
                this.bestGrid = [];
                this.temperature = 1.0;
                this.coolingRate = 0.995;
                this.generation = 0;
                this.isRunning = false;

                this.initialize();
            }

            randomChar() {
                return ASCII_CHARS[Math.floor(Math.random() * ASCII_CHARS.length)];
            }

            initialize() {
                this.grid = [];
                for (let y = 0; y < this.height; y++) {
                    const row = [];
                    for (let x = 0; x < this.width; x++) {
                        row.push(this.randomChar());
                    }
                    this.grid.push(row);
                }
                this.bestGrid = this.grid.map(row => [...row]);
                this.bestScore = this.evaluate(this.grid);
            }

            scoreSymmetry(grid) {
                let score = 0;

                // ç¸¦å¯¾ç§°
                for (let y = 0; y < this.height; y++) {
                    for (let x = 0; x < Math.floor(this.width / 2); x++) {
                        if (grid[y][x] === grid[y][this.width - 1 - x]) {
                            score++;
                        }
                    }
                }

                // æ¨ªå¯¾ç§°
                for (let y = 0; y < Math.floor(this.height / 2); y++) {
                    for (let x = 0; x < this.width; x++) {
                        if (grid[y][x] === grid[this.height - 1 - y][x]) {
                            score++;
                        }
                    }
                }

                return score / (this.width * this.height);
            }

            scoreRepetition(grid) {
                let score = 0;

                // æ¨ªæ–¹å‘ã®åå¾©
                for (let y = 0; y < this.height; y++) {
                    for (let x = 0; x < this.width - 4; x++) {
                        const pattern = grid[y].slice(x, x + 4);
                        for (let x2 = x + 4; x2 < this.width - 4; x2++) {
                            const pattern2 = grid[y].slice(x2, x2 + 4);
                            if (JSON.stringify(pattern) === JSON.stringify(pattern2)) {
                                score++;
                            }
                        }
                    }
                }

                return score / 10;
            }

            scoreContrast(grid) {
                const charCounts = {};
                for (let y = 0; y < this.height; y++) {
                    for (let x = 0; x < this.width; x++) {
                        const char = grid[y][x];
                        charCounts[char] = (charCounts[char] || 0) + 1;
                    }
                }

                const total = this.width * this.height;
                let entropy = 0;
                for (const count of Object.values(charCounts)) {
                    const p = count / total;
                    if (p > 0) {
                        entropy -= p * Math.log2(p);
                    }
                }

                return entropy;
            }

            evaluate(grid) {
                const symmetry = this.scoreSymmetry(grid) * 2;
                const repetition = this.scoreRepetition(grid);
                const contrast = this.scoreContrast(grid) * 0.5;

                return symmetry + repetition + contrast;
            }

            mutate() {
                const newGrid = this.grid.map(row => [...row]);

                // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤å¤‰ç•°
                const x = Math.floor(Math.random() * this.width);
                const y = Math.floor(Math.random() * this.height);
                newGrid[y][x] = this.randomChar();

                return newGrid;
            }

            step() {
                const newGrid = this.mutate();
                const newScore = this.evaluate(newGrid);

                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ»ã‚¢ãƒ‹ãƒ¼ãƒªãƒ³ã‚°
                const delta = newScore - this.evaluate(this.grid);
                const probability = delta > 0 ? 1 : Math.exp(delta / this.temperature);

                if (Math.random() < probability) {
                    this.grid = newGrid;

                    if (newScore > this.bestScore) {
                        this.bestScore = newScore;
                        this.bestGrid = this.grid.map(row => [...row]);
                    }
                }

                this.temperature *= this.coolingRate;
                this.generation++;

                this.updateDisplay();
            }

            updateDisplay() {
                document.getElementById('ascii-canvas').textContent = this.bestGrid.map(row => row.join('')).join('\n');
                document.getElementById('generation').textContent = this.generation;
                document.getElementById('best-score').textContent = this.bestScore.toFixed(2);
                document.getElementById('temperature').textContent = this.temperature.toFixed(3);
                document.getElementById('progress-bar').style.width = `${Math.min(100, this.generation / 5)}%`;
            }

            run() {
                this.isRunning = true;
                const evolve = () => {
                    if (!this.isRunning) return;

                    this.step();

                    if (this.temperature > 0.01) {
                        requestAnimationFrame(evolve);
                    } else {
                        this.isRunning = false;
                        document.getElementById('startBtn').textContent = 'ğŸš€ é€²åŒ–é–‹å§‹';
                    }
                };

                evolve();
            }

            stop() {
                this.isRunning = false;
            }

            reset() {
                this.generation = 0;
                this.temperature = 1.0;
                this.bestScore = -Infinity;
                this.initialize();
                this.updateDisplay();
            }
        }

        // åˆæœŸåŒ–
        const evo = new EvolutionaryASCII(50, 25);
        evo.updateDisplay();

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('startBtn').addEventListener('click', function() {
            if (evo.isRunning) {
                evo.stop();
                this.textContent = 'ğŸš€ é€²åŒ–é–‹å§‹';
            } else {
                evo.run();
                this.textContent = 'â¸ åœæ­¢';
            }
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            evo.step();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            evo.stop();
            evo.reset();
            document.getElementById('startBtn').textContent = 'ğŸš€ é€²åŒ–é–‹å§‹';
        });
    </script>
</body>
</html>
