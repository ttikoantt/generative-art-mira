<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Rain | Matrix-inspired Generative Art</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }

        canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #0f0;
            font-size: 14px;
            text-shadow: 0 0 10px #0f0;
            z-index: 100;
            pointer-events: none;
            opacity: 0.8;
        }

        .title {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #0f0;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 20px #0f0, 0 0 40px #0f0;
            z-index: 100;
            pointer-events: none;
            letter-spacing: 4px;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #0f0;
            color: #0f0;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            z-index: 100;
            text-shadow: 0 0 10px #0f0;
            transition: all 0.3s;
        }

        .fullscreen-btn:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        @media (max-width: 768px) {
            .title {
                font-size: 18px;
                top: 15px;
            }

            .info {
                font-size: 12px;
                bottom: 15px;
                left: 15px;
            }

            .fullscreen-btn {
                padding: 8px 15px;
                font-size: 12px;
                top: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="title">DIGITAL RAIN</div>
    <div class="info" id="info"></div>
    <button class="fullscreen-btn" id="fullscreenBtn">⛶ 全画面</button>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const info = document.getElementById('info');
        const fullscreenBtn = document.getElementById('fullscreenBtn');

        let width, height;
        let drops = [];
        let animationId;
        let startTime = Date.now();

        // Settings
        const fontSize = 16;
        const columns = 80;
        const chars = 'アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const fadeSpeed = 0.05;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initDrops();
        }

        function initDrops() {
            const columnCount = Math.floor(width / fontSize);
            drops = [];
            for (let i = 0; i < columnCount; i++) {
                drops.push({
                    x: i * fontSize,
                    y: Math.random() * -height,
                    speed: Math.random() * 3 + 2,
                    chars: [],
                    length: Math.floor(Math.random() * 20) + 10
                });
            }
        }

        function draw() {
            // Fade effect
            ctx.fillStyle = `rgba(0, 0, 0, ${fadeSpeed})`;
            ctx.fillRect(0, 0, width, height);

            drops.forEach(drop => {
                // Update position
                drop.y += drop.speed;

                // Add new character
                const char = chars[Math.floor(Math.random() * chars.length)];
                drop.chars.push({
                    char: char,
                    alpha: 1,
                    glow: Math.random() > 0.95
                });

                // Remove old characters
                if (drop.chars.length > drop.length) {
                    drop.chars.shift();
                }

                // Draw characters
                drop.chars.forEach((c, index) => {
                    const yPos = drop.y - (drop.chars.length - index) * fontSize;

                    if (yPos > 0 && yPos < height + fontSize) {
                        const brightness = index / drop.chars.length;
                        const alpha = c.alpha * brightness;

                        if (c.glow && index === drop.chars.length - 1) {
                            // Glowing head
                            ctx.fillStyle = '#fff';
                            ctx.shadowBlur = 20;
                            ctx.shadowColor = '#0f0';
                        } else if (index === drop.chars.length - 1) {
                            // Bright head
                            ctx.fillStyle = '#0f0';
                            ctx.shadowBlur = 10;
                            ctx.shadowColor = '#0f0';
                        } else {
                            // Fading tail
                            const green = Math.floor(200 * brightness);
                            ctx.fillStyle = `rgba(0, ${green}, 0, ${alpha})`;
                            ctx.shadowBlur = 0;
                        }

                        ctx.font = `${fontSize}px "Courier New", monospace`;
                        ctx.fillText(c.char, drop.x, yPos);
                    }
                });

                // Reset when off screen
                if (drop.y > height + drop.length * fontSize + 100) {
                    drop.y = Math.random() * -200 - 100;
                    drop.chars = [];
                    drop.length = Math.floor(Math.random() * 20) + 10;
                }
            });

            // Update info
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
            info.textContent = `Time: ${elapsed}s | Drops: ${drops.length} | FPS: 60`;

            animationId = requestAnimationFrame(draw);
        }

        // Fullscreen
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenBtn.textContent = '⛶ 解除';
            } else {
                document.exitFullscreen();
                fullscreenBtn.textContent = '⛶ 全画面';
            }
        });

        // Initialize
        window.addEventListener('resize', resize);
        resize();
        draw();

        // Touch support for mobile
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const column = Math.floor(touchX / fontSize);
            if (drops[column]) {
                drops[column].speed = Math.random() * 5 + 3;
            }
        });
    </script>
</body>
</html>
