<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«ãªæ£® | Fractal Forest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            height: 100vh;
        }

        h1 {
            color: #eee;
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .subtitle {
            color: #aaa;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        #canvas {
            background: linear-gradient(to bottom,
                #0a0a15 0%,
                #1a1a2e 50%,
                #2d3561 100%
            );
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            cursor: pointer;
            touch-action: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #eee;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: #eee;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.4rem;
            }

            .subtitle {
                font-size: 0.8rem;
            }

            button {
                padding: 8px 16px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ² ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«ãªæ£®</h1>
        <p class="subtitle">Fractal Forest - ã‚¿ãƒƒãƒ—ã§æ–°ã—ã„æœ¨ã‚’æ¤ãˆã‚‹</p>

        <canvas id="canvas"></canvas>

        <div class="controls">
            <button onclick="changeSeason('spring')">ğŸŒ¸ æ˜¥</button>
            <button onclick="changeSeason('summer')">ğŸŒ¿ å¤</button>
            <button onclick="changeSeason('autumn')">ğŸ‚ ç§‹</button>
            <button onclick="changeSeason('winter')">â„ï¸ å†¬</button>
            <button onclick="regenerate()">ğŸ”„ å†ç”Ÿæˆ</button>
        </div>

        <div class="info">ã‚¯ãƒªãƒƒã‚¯ã§æ–°ã—ã„æœ¨ã‚’æ¤ãˆã‚‹ | å„å­£ç¯€ã§è¡¨æƒ…ãŒå¤‰ã‚ã‚Šã¾ã™</div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºè¨­å®š
        function resizeCanvas() {
            const maxWidth = Math.min(window.innerWidth - 40, 800);
            const maxHeight = Math.min(window.innerHeight - 250, 600);
            canvas.width = maxWidth;
            canvas.height = maxHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', () => {
            resizeCanvas();
            generateForest();
        });

        // è¨­å®š
        let trees = [];
        let season = 'spring';
        let windTime = 0;
        let stars = [];

        // å­£ç¯€ã®è‰²è¨­å®š
        const seasonColors = {
            spring: {
                sky: ['#ffecd2', '#fcb69f'],
                leaf: ['#ff9a9e', '#fecfef', '#ffecd2', '#fcb69f'],
                trunk: '#8b4513'
            },
            summer: {
                sky: ['#a1c4fd', '#c2e9fb'],
                leaf: ['#4caf50', '#8bc34a', '#cddc39', '#388e3c'],
                trunk: '#5d4037'
            },
            autumn: {
                sky: ['#ffd89b', '#19547b'],
                leaf: ['#ff6b6b', '#feca57', '#ff9f43', '#ee5a24'],
                trunk: '#6d4c41'
            },
            winter: {
                sky: ['#e6dada', '#274046'],
                leaf: ['#ecf0f1', '#bdc3c7', '#95a5a6', '#7f8c8d'],
                trunk: '#4e342e'
            }
        };

        // æ˜Ÿã‚’ç”Ÿæˆ
        function generateStars() {
            stars = [];
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height * 0.6,
                    size: Math.random() * 2,
                    twinkle: Math.random() * Math.PI * 2
                });
            }
        }

        // æœ¨ã®ã‚¯ãƒ©ã‚¹
        class Tree {
            constructor(x, depth) {
                this.x = x;
                this.y = canvas.height;
                this.depth = depth;
                this.seed = Math.random();
            }

            draw() {
                const trunkLength = canvas.height * 0.25;
                this.drawBranch(
                    this.x,
                    this.y,
                    -Math.PI / 2,
                    trunkLength,
                    this.depth
                );
            }

            drawBranch(x, y, angle, length, depth) {
                if (depth === 0) return;

                // é¢¨ã«ã‚ˆã‚‹è§’åº¦ã®å¤‰åŒ–
                const windStrength = 0.02;
                const windOffset = Math.sin(windTime + this.seed * 10 + depth) * windStrength * (12 - depth) * 0.1;

                const newAngle = angle + windOffset;
                const endX = x + Math.cos(newAngle) * length;
                const endY = y + Math.sin(newAngle) * length;

                // å¹…ã¯æ·±ã•ã«æ¯”ä¾‹
                const lineWidth = depth * 1.5;

                // è‰²ã®é¸æŠ
                const colors = seasonColors[season];
                ctx.strokeStyle = depth > 2 ? colors.trunk : colors.leaf[Math.floor(Math.random() * colors.leaf.length)];
                ctx.lineWidth = lineWidth;
                ctx.lineCap = 'round';

                // åˆ†å²ã‚’æç”»
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(endX, endY);
                ctx.stroke();

                // è‘‰ï¼ˆæ·±ã•2ä»¥ä¸‹ã§ï¼‰
                if (depth <= 3) {
                    const leafSize = depth * 3;
                    ctx.fillStyle = colors.leaf[Math.floor(Math.random() * colors.leaf.length)];
                    ctx.beginPath();
                    ctx.arc(endX, endY, leafSize, 0, Math.PI * 2);
                    ctx.fill();
                }

                // å†å¸°çš„ã«åˆ†å²
                const angleSpread = 0.4 + Math.sin(this.seed * depth) * 0.1;
                const lengthScale = 0.7 + Math.cos(this.seed * depth) * 0.1;

                this.drawBranch(endX, endY, newAngle - angleSpread, length * lengthScale, depth - 1);
                this.drawBranch(endX, endY, newAngle + angleSpread, length * lengthScale, depth - 1);
            }
        }

        // æ£®ã‚’ç”Ÿæˆ
        function generateForest() {
            trees = [];
            const numTrees = 5 + Math.floor(Math.random() * 5);
            for (let i = 0; i < numTrees; i++) {
                const x = (canvas.width / (numTrees + 1)) * (i + 1);
                const depth = 6 + Math.floor(Math.random() * 4);
                trees.push(new Tree(x, depth));
            }
            generateStars();
        }

        // å­£ç¯€ã‚’å¤‰æ›´
        function changeSeason(newSeason) {
            season = newSeason;
        }

        // å†ç”Ÿæˆ
        function regenerate() {
            generateForest();
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function animate() {
            // èƒŒæ™¯ã‚’ã‚¯ãƒªã‚¢
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            const skyColors = season === 'winter'
                ? ['#0f0c29', '#302b63', '#24243e']
                : ['#0a0a15', '#1a1a2e', '#2d3561'];
            gradient.addColorStop(0, skyColors[0]);
            gradient.addColorStop(0.5, skyColors[1]);
            gradient.addColorStop(1, skyColors[2]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ˜Ÿã‚’æç”»ï¼ˆå†¬ã®ã¿ï¼‰
            if (season === 'winter') {
                stars.forEach(star => {
                    star.twinkle += 0.02;
                    const alpha = 0.5 + Math.sin(star.twinkle) * 0.5;
                    ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            // åœ°é¢
            ctx.fillStyle = season === 'winter' ? '#ecf0f1' : '#3d2914';
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

            // æœ¨ã‚’æç”»
            trees.forEach(tree => tree.draw());

            // é¢¨ã®æ™‚é–“ã‚’æ›´æ–°
            windTime += 0.02;

            requestAnimationFrame(animate);
        }

        // ã‚¯ãƒªãƒƒã‚¯ã§æ–°ã—ã„æœ¨ã‚’è¿½åŠ 
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const depth = 6 + Math.floor(Math.random() * 4);
            trees.push(new Tree(x, depth));

            // æœ¨ãŒå¤šã™ããŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
            if (trees.length > 12) {
                trees.shift();
            }
        });

        // ã‚¿ãƒƒãƒå¯¾å¿œ
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const depth = 6 + Math.floor(Math.random() * 4);
            trees.push(new Tree(x, depth));

            if (trees.length > 12) {
                trees.shift();
            }
        });

        // å…¨ç”»é¢è¡¨ç¤º
        document.addEventListener('keydown', (e) => {
            if (e.key === 'f') {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    canvas.requestFullscreen();
                }
            }
        });

        // åˆæœŸåŒ–
        generateForest();
        animate();

        // å…¨ç”»é¢è¡¨ç¤ºãƒœã‚¿ãƒ³
        document.addEventListener('keydown', (e) => {
            if (e.key === 'f') {
                toggleFullscreen();
            }
        });

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }
    </script>
</body>
</html>
