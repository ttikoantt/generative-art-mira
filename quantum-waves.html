<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Waves - 量子波動</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }

        canvas {
            display: block;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            color: #0ff;
            border: 1px solid #0ff;
            z-index: 100;
            max-width: 280px;
        }

        .controls h2 {
            font-size: 18px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #0ff;
        }

        .control {
            margin-bottom: 15px;
        }

        .control label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            color: #0ff;
        }

        .control input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: #033;
            border-radius: 3px;
            outline: none;
        }

        .control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #0ff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #0ff;
        }

        .control input[type="color"] {
            width: 100%;
            height: 35px;
            border: 1px solid #0ff;
            background: #000;
            cursor: pointer;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #0ff;
            color: #0ff;
            padding: 12px 24px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            z-index: 100;
            transition: all 0.3s;
        }

        .fullscreen-btn:hover {
            background: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 20px #0ff;
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #0ff;
            font-size: 11px;
            text-shadow: 0 0 5px #0ff;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .controls {
                top: auto;
                bottom: 60px;
                left: 10px;
                right: 10px;
                max-width: none;
                padding: 15px;
                font-size: 11px;
            }

            .fullscreen-btn {
                top: 10px;
                right: 10px;
                padding: 10px 20px;
                font-size: 12px;
            }

            .info {
                display: none;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div class="controls">
        <h2>⚛️ Quantum Waves</h2>
        <div class="control">
            <label>波の数: <span id="waveCountLabel">5</span></label>
            <input type="range" id="waveCount" min="1" max="10" value="5">
        </div>
        <div class="control">
            <label>周波数: <span id="frequencyLabel">2.0</span></label>
            <input type="range" id="frequency" min="0.5" max="5" step="0.1" value="2">
        </div>
        <div class="control">
            <label>振幅: <span id="amplitudeLabel">50</span></label>
            <input type="range" id="amplitude" min="20" max="100" value="50">
        </div>
        <div class="control">
            <label>速度: <span id="speedLabel">1.0</span></label>
            <input type="range" id="speed" min="0.2" max="3" step="0.1" value="1">
        </div>
        <div class="control">
            <label>色1</label>
            <input type="color" id="color1" value="#00ffff">
        </div>
        <div class="control">
            <label>色2</label>
            <input type="color" id="color2" value="#ff00ff">
        </div>
    </div>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">全画面</button>

    <div class="info">
        マウスを動かして波を操作 • クリックで波源を追加
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;

        // 設定
        let config = {
            waveCount: 5,
            frequency: 2,
            amplitude: 50,
            speed: 1,
            color1: '#00ffff',
            color2: '#ff00ff'
        };

        // 波源
        let waveSources = [];

        // 時間
        let time = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;

            // 初期波源を設定
            if (waveSources.length === 0) {
                waveSources = [
                    { x: width * 0.3, y: height * 0.5 },
                    { x: width * 0.7, y: height * 0.5 }
                ];
            }
        }

        window.addEventListener('resize', resize);
        resize();

        // マウス操作
        let mouse = { x: 0, y: 0 };

        canvas.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        canvas.addEventListener('click', () => {
            waveSources.push({ x: mouse.x, y: mouse.y });
            if (waveSources.length > 5) {
                waveSources.shift();
            }
        });

        // タッチ操作
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            mouse.x = touch.clientX;
            mouse.y = touch.clientY;
        });

        canvas.addEventListener('touchstart', (e) => {
            const touch = e.touches[0];
            mouse.x = touch.clientX;
            mouse.y = touch.clientY;
        });

        // 設定コントロール
        document.getElementById('waveCount').addEventListener('input', (e) => {
            config.waveCount = parseInt(e.target.value);
            document.getElementById('waveCountLabel').textContent = config.waveCount;
        });

        document.getElementById('frequency').addEventListener('input', (e) => {
            config.frequency = parseFloat(e.target.value);
            document.getElementById('frequencyLabel').textContent = config.frequency.toFixed(1);
        });

        document.getElementById('amplitude').addEventListener('input', (e) => {
            config.amplitude = parseInt(e.target.value);
            document.getElementById('amplitudeLabel').textContent = config.amplitude;
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            config.speed = parseFloat(e.target.value);
            document.getElementById('speedLabel').textContent = config.speed.toFixed(1);
        });

        document.getElementById('color1').addEventListener('input', (e) => {
            config.color1 = e.target.value;
        });

        document.getElementById('color2').addEventListener('input', (e) => {
            config.color2 = e.target.value;
        });

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 255, b: 255 };
        }

        function calculateWave(x, y, source) {
            const dx = x - source.x;
            const dy = y - source.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const wave = Math.sin(distance * config.frequency * 0.01 - time * config.speed);
            return wave * config.amplitude;
        }

        function draw() {
            // 半透明の黒でフェード効果
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, width, height);

            const rgb1 = hexToRgb(config.color1);
            const rgb2 = hexToRgb(config.color2);

            // ピクセル単位で計算（パフォーマンスのため粗いグリッド）
            const resolution = 4;

            for (let x = 0; x < width; x += resolution) {
                for (let y = 0; y < height; y += resolution) {
                    // 全ての波源からの波を合成
                    let totalWave = 0;

                    for (const source of waveSources) {
                        totalWave += calculateWave(x, y, source);
                    }

                    // 正規化
                    totalWave /= waveSources.length;

                    // 色の補間
                    const normalizedWave = (totalWave + config.amplitude) / (config.amplitude * 2);
                    const r = Math.floor(rgb1.r + (rgb2.r - rgb1.r) * normalizedWave);
                    const g = Math.floor(rgb1.g + (rgb2.g - rgb1.g) * normalizedWave);
                    const b = Math.floor(rgb1.b + (rgb2.b - rgb1.b) * normalizedWave);

                    // 明度調整
                    const brightness = Math.abs(totalWave) / config.amplitude;
                    const alpha = brightness * 0.8 + 0.2;

                    ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                    ctx.fillRect(x, y, resolution, resolution);
                }
            }

            // 波源を描画
            for (const source of waveSources) {
                ctx.beginPath();
                ctx.arc(source.x, source.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = config.color1;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            time += 0.05;
            requestAnimationFrame(draw);
        }

        draw();

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
    </script>
</body>
</html>
