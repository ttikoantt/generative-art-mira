<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Fractal Garden</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            color: #fff;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            margin: 20px 0;
            text-align: center;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
        }

        #canvas {
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.3);
            cursor: crosshair;
        }

        .controls {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            max-width: 90vw;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        label {
            color: #b0b0ff;
            font-size: 0.9rem;
            font-weight: 500;
        }

        input[type="range"] {
            width: 150px;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #8a2be2, #4169e1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.8);
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #8a2be2, #4169e1);
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        .info {
            color: #9090b0;
            font-size: 0.85rem;
            text-align: center;
            margin-top: 15px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
                margin: 15px 0;
            }

            .controls {
                gap: 10px;
            }

            input[type="range"] {
                width: 120px;
            }

            button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸŒ¿ Interactive Fractal Garden</h1>

    <canvas id="canvas"></canvas>

    <div class="controls">
        <div class="control-group">
            <label>åˆ†å²è§’åº¦: <span id="angleValue">25</span>Â°</label>
            <input type="range" id="angle" min="10" max="45" value="25">
        </div>

        <div class="control-group">
            <label>æˆé•·æ®µéš: <span id="depthValue">10</span></label>
            <input type="range" id="depth" min="5" max="14" value="10">
        </div>

        <div class="control-group">
            <label>æã®é•·ã•: <span id="lengthValue">120</span></label>
            <input type="range" id="length" min="80" max="160" value="120">
        </div>

        <button id="regenerate">ğŸŒ± æ–°ã—ã„æ¤ç‰©ã‚’ç”Ÿæˆ</button>
        <button id="fullscreen">ğŸ“º å…¨ç”»é¢</button>
    </div>

    <p class="info">ğŸ–±ï¸ ãƒã‚¦ã‚¹ã‚’å‹•ã‹ã™ã¨æ¤ç‰©ãŒåå¿œã—ã¾ã™ | ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´</p>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚º
        function resizeCanvas() {
            const maxWidth = Math.min(window.innerWidth - 40, 800);
            const maxHeight = Math.min(window.innerHeight - 280, 600);
            canvas.width = maxWidth;
            canvas.height = maxHeight;
            draw();
        }

        window.addEventListener('resize', resizeCanvas);

        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        let angle = 25;
        let depth = 10;
        let branchLength = 120;
        let mouseX = 0;
        let mouseY = 0;

        // è‰²ç›¸ã‚’æ™‚åˆ»ã§å¤‰åŒ–
        function getHue() {
            const hour = new Date().getHours();
            return (hour * 15) % 360;
        }

        // è‰²ç›¸ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function getColor(depth, maxDepth) {
            const baseHue = getHue();
            const hue = (baseHue + depth * 20) % 360;
            const saturation = 70 + depth * 2;
            const lightness = 60 + depth * 2;
            return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
        }

        // ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«æœ¨æç”»
        function drawBranch(x, y, length, angle, currentDepth) {
            if (currentDepth <= 0 || length < 2) return;

            const endX = x + length * Math.cos(angle);
            const endY = y - length * Math.sin(angle);

            // æã®æç”»
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(endX, endY);

            const lineWidth = currentDepth * 0.8;
            ctx.lineWidth = lineWidth;
            ctx.strokeStyle = getColor(depth - currentDepth, depth);
            ctx.lineCap = 'round';
            ctx.shadowColor = getColor(depth - currentDepth, depth);
            ctx.shadowBlur = currentDepth * 1.5;
            ctx.stroke();

            // è‘‰ã‚„èŠ±ã‚’æç”»ï¼ˆæœ«ç«¯ï¼‰
            if (currentDepth <= 2) {
                drawLeaf(endX, endY, currentDepth);
            }

            // ãƒã‚¦ã‚¹ä½ç½®ã§åˆ†å²è§’åº¦ã‚’å¾®èª¿æ•´
            const dx = (mouseX - canvas.width / 2) / canvas.width;
            const dy = (mouseY - canvas.height) / canvas.height;

            const angleRad = (angle + dx * 10) * Math.PI / 180;
            const angleVariation = 1 + dy * 0.3;

            // å·¦ã®æ
            drawBranch(
                endX,
                endY,
                length * 0.75 * angleVariation,
                angle - angleRad,
                currentDepth - 1
            );

            // å³ã®æ
            drawBranch(
                endX,
                endY,
                length * 0.75 * angleVariation,
                angle + angleRad,
                currentDepth - 1
            );
        }

        // è‘‰ã‚„èŠ±ã®æç”»
        function drawLeaf(x, y, size) {
            ctx.beginPath();
            const leafSize = size * 4;
            ctx.arc(x, y, leafSize, 0, Math.PI * 2);
            ctx.fillStyle = getColor(depth, depth);
            ctx.shadowColor = getColor(depth, depth);
            ctx.shadowBlur = 20;
            ctx.globalAlpha = 0.6;
            ctx.fill();
            ctx.globalAlpha = 1;
        }

        // ãƒ¡ã‚¤ãƒ³æç”»é–¢æ•°
        function draw() {
            // èƒŒæ™¯ã‚¯ãƒªã‚¢
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ˜Ÿç©ºåŠ¹æœ
            drawStars();

            // åœ°é¢
            const groundY = canvas.height - 30;
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, groundY, canvas.width, 30);

            // æ¤ç‰©ã‚’æç”»
            const startX = canvas.width / 2;
            const startY = groundY;
            drawBranch(startX, startY, branchLength, Math.PI / 2, depth);
        }

        // æ˜Ÿç©ºã‚’æç”»
        function drawStars() {
            const numStars = 50;
            for (let i = 0; i < numStars; i++) {
                const x = (i * 137.5) % canvas.width;
                const y = (i * 73.3) % (canvas.height / 2);
                const size = (Math.sin(Date.now() / 1000 + i) + 1) * 1.5;

                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${0.3 + Math.random() * 0.4})`;
                ctx.fill();
            }
        }

        // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
            requestAnimationFrame(draw);
        });

        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            mouseX = touch.clientX - rect.left;
            mouseY = touch.clientY - rect.top;
            requestAnimationFrame(draw);
        }, { passive: false });

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('angle').addEventListener('input', (e) => {
            angle = parseInt(e.target.value);
            document.getElementById('angleValue').textContent = angle;
            requestAnimationFrame(draw);
        });

        document.getElementById('depth').addEventListener('input', (e) => {
            depth = parseInt(e.target.value);
            document.getElementById('depthValue').textContent = depth;
            requestAnimationFrame(draw);
        });

        document.getElementById('length').addEventListener('input', (e) => {
            branchLength = parseInt(e.target.value);
            document.getElementById('lengthValue').textContent = branchLength;
            requestAnimationFrame(draw);
        });

        // å†ç”Ÿæˆãƒœã‚¿ãƒ³
        document.getElementById('regenerate').addEventListener('click', () => {
            draw();
        });

        // å…¨ç”»é¢ãƒœã‚¿ãƒ³
        document.getElementById('fullscreen').addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                canvas.requestFullscreen();
            }
        });

        // åˆæœŸåŒ–
        resizeCanvas();

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆæ˜Ÿç©ºã®æ›´æ–°ï¼‰
        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        animate();
    </script>
</body>
</html>
