<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç´„É©„Éº„Éë„Çø„Éº„É≥„Éª„É°„É¢„É™ | Game by Mira</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            color: #0ff;
            font-size: 18px;
        }

        .stats span {
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .message {
            text-align: center;
            color: #fff;
            font-size: 16px;
            margin-bottom: 20px;
            min-height: 24px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .pattern-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }

        .pattern-row {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .color-box {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .color-box:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .color-box.selected {
            transform: scale(0.95);
            box-shadow: 0 0 20px currentColor;
        }

        .color-box.hidden {
            background: #333 !important;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .color-box.correct {
            animation: correctPulse 0.5s;
        }

        .color-box.wrong {
            animation: wrongPulse 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); box-shadow: 0 0 30px #0f0; }
        }

        @keyframes wrongPulse {
            0%, 100% { transform: scale(1); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .guess-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .guess-btn {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .guess-btn:hover {
            transform: scale(1.1);
            border-color: #fff;
        }

        .guess-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .action-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            padding: 15px 30px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 212, 255, 0.6);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 212, 255, 0.2);
            border: 2px solid #00d4ff;
            color: #fff;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .fullscreen-btn:hover {
            background: rgba(0, 212, 255, 0.4);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 22px;
            }

            .color-box {
                width: 60px;
                height: 60px;
            }

            .guess-btn {
                width: 50px;
                height: 50px;
            }

            .stats {
                font-size: 16px;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® „Ç´„É©„Éº„Éë„Çø„Éº„É≥„Éª„É°„É¢„É™</h1>

        <div class="stats">
            <span>Level: <strong id="level">1</strong></span>
            <span>Score: <strong id="score">0</strong></span>
        </div>

        <div class="message" id="message">„Éë„Çø„Éº„É≥„ÇíË¶ö„Åà„Å¶ÔºÅ</div>

        <div class="pattern-container" id="pattern"></div>

        <div class="guess-container" id="guesses"></div>

        <button class="action-btn" id="startBtn" onclick="startGame()">„Çπ„Çø„Éº„Éà</button>
    </div>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">ÂÖ®ÁîªÈù¢</button>

    <script>
        // Ëâ≤„Éë„É¨„ÉÉ„Éà
        const colors = [
            '#FF6B6B', // Red
            '#4ECDC4', // Cyan
            '#45B7D1', // Blue
            '#96CEB4', // Green
            '#FFEAA7', // Yellow
            '#DDA0DD', // Plum
            '#98D8C8', // Mint
            '#F7DC6F', // Gold
            '#BB8FCE', // Purple
            '#85C1E9', // Sky
        ];

        let pattern = [];
        let guessPattern = [];
        let level = 1;
        let score = 0;
        let gridSize = 3;
        let showingPattern = false;
        let availableColors = [];

        function generatePattern() {
            pattern = [];
            guessPattern = [];
            const totalBoxes = gridSize * gridSize;
            availableColors = shuffleArray([...colors]).slice(0, totalBoxes);

            for (let i = 0; i < totalBoxes; i++) {
                pattern.push(availableColors[i]);
                guessPattern.push(null);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function renderPattern() {
            const container = document.getElementById('pattern');
            container.innerHTML = '';

            for (let row = 0; row < gridSize; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'pattern-row';

                for (let col = 0; col < gridSize; col++) {
                    const index = row * gridSize + col;
                    const box = document.createElement('div');
                    box.className = 'color-box';
                    box.dataset.index = index;

                    if (showingPattern) {
                        box.style.background = pattern[index];
                    } else {
                        box.classList.add('hidden');
                    }

                    box.onclick = () => selectBox(index);
                    rowDiv.appendChild(box);
                }

                container.appendChild(rowDiv);
            }
        }

        function renderGuesses() {
            const container = document.getElementById('guesses');
            container.innerHTML = '';

            const usedColors = [...new Set(guessPattern.filter(c => c !== null))];

            availableColors.forEach(color => {
                const btn = document.createElement('button');
                btn.className = 'guess-btn';
                btn.style.background = color;

                if (usedColors.includes(color)) {
                    btn.classList.add('disabled');
                }

                btn.onclick = () => selectColor(color);
                container.appendChild(btn);
            });
        }

        let selectedIndex = null;

        function selectBox(index) {
            if (showingPattern) return;

            // ÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.color-box').forEach(box => {
                box.classList.remove('selected');
            });

            selectedIndex = index;
            const box = document.querySelector(`[data-index="${index}"]`);
            box.classList.add('selected');

            setMessage('Ëâ≤„ÇíÈÅ∏„Çì„ÅßÔºÅ');
        }

        function selectColor(color) {
            if (showingPattern || selectedIndex === null) return;

            guessPattern[selectedIndex] = color;
            const box = document.querySelector(`[data-index="${selectedIndex}"]`);
            box.style.background = color;
            box.classList.remove('selected');

            selectedIndex = null;
            renderGuesses();

            // „Åô„Åπ„Å¶Âüã„Åæ„Å£„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (!guessPattern.includes(null)) {
                checkAnswer();
            }
        }

        function checkAnswer() {
            let correct = 0;
            const boxes = document.querySelectorAll('.color-box');

            pattern.forEach((color, index) => {
                const box = boxes[index];
                if (guessPattern[index] === color) {
                    correct++;
                    box.classList.add('correct');
                } else {
                    box.classList.add('wrong');
                }
            });

            setTimeout(() => {
                if (correct === pattern.length) {
                    // ÂÆåÂÖ®Ê≠£Ëß£
                    score += level * 10;
                    level++;
                    if (level % 3 === 0 && gridSize < 5) {
                        gridSize++;
                    }
                    updateStats();
                    setMessage('üéâ ÂÆåÁíßÔºÅÊ¨°„ÅÆ„É¨„Éô„É´„Å∏ÔºÅ');
                    setTimeout(() => startRound(), 1500);
                } else {
                    // ÈñìÈÅï„ÅÑ„ÅÇ„Çä
                    setMessage(`‚ö†Ô∏è ${correct}/${pattern.length} Ê≠£Ëß£ÔºÅ„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÔºÅ`);
                    setTimeout(() => startRound(), 2000);
                }
            }, 500);
        }

        function startRound() {
            generatePattern();
            renderPattern();
            renderGuesses();

            // „Éë„Çø„Éº„É≥„ÇíË¶ã„Åõ„ÇãÊôÇÈñì
            showingPattern = true;
            setMessage('„Éë„Çø„Éº„É≥„ÇíË¶ö„Åà„Å¶ÔºÅ');

            const showTime = 2000 + (level * 500); // „É¨„Éô„É´„Åå‰∏ä„Åå„Çã„Åª„Å©Èï∑„Åè

            setTimeout(() => {
                showingPattern = false;
                renderPattern();
                setMessage('„Å©„ÅÆËâ≤„Å†„Å£„Åü„ÅãË¶ö„Åà„Å¶„ÇãÔºü');
            }, Math.min(showTime, 5000));
        }

        function startGame() {
            level = 1;
            score = 0;
            gridSize = 3;
            updateStats();

            document.getElementById('startBtn').disabled = true;
            startRound();
        }

        function updateStats() {
            document.getElementById('level').textContent = level;
            document.getElementById('score').textContent = score;
        }

        function setMessage(msg) {
            document.getElementById('message').textContent = msg;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // ÂàùÊúüÂåñ
        generatePattern();
        renderPattern();
        renderGuesses();
    </script>
</body>
</html>
