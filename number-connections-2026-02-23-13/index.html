<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Êï∞Â≠ó„ÅÆ„Å§„Å™„Åå„Çä - Number Connections</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #eee;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            color: #88aaff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .stat {
            text-align: center;
            color: #fff;
        }

        .stat-label {
            font-size: 12px;
            color: #aaccff;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        .question-area {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(100, 150, 255, 0.3);
        }

        .numbers-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .number {
            font-size: 48px;
            font-weight: bold;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.5);
        }

        .operator {
            font-size: 36px;
            color: #ffd700;
        }

        .question {
            color: #fff;
            text-align: center;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .hint {
            color: #aaccff;
            text-align: center;
            font-size: 14px;
            font-style: italic;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 20px;
            border-radius: 15px;
            color: #fff;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .option-btn:active {
            transform: translateY(-1px);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            animation: correctPulse 0.5s;
        }

        .option-btn.wrong {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            animation: wrongShake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .next-btn {
            width: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            padding: 15px;
            border-radius: 15px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .next-btn.visible {
            display: block;
        }

        .game-over {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            display: none;
        }

        .game-over.visible {
            display: block;
        }

        .game-over h2 {
            color: #ffd700;
            font-size: 32px;
            margin-bottom: 15px;
        }

        .game-over p {
            color: #fff;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .game-over .final-score {
            font-size: 48px;
            color: #4fc3f7;
            margin: 20px 0;
        }

        .restart-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 15px 40px;
            border-radius: 15px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            font-weight: bold;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            animation: feedbackPop 0.8s forwards;
            pointer-events: none;
            z-index: 1000;
        }

        .feedback.correct {
            color: #38ef7d;
        }

        .feedback.wrong {
            color: #f45c43;
        }

        @keyframes feedbackPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }

        .lives {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 10px;
        }

        .heart {
            font-size: 24px;
            color: #ff6b6b;
        }

        .heart.lost {
            color: #444;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" id="fullscreen">ÂÖ®ÁîªÈù¢</button>

    <div class="container">
        <h1>üî¢ Êï∞Â≠ó„ÅÆ„Å§„Å™„Åå„Çä</h1>
        <p class="subtitle">Êï∞Ë´ñÁöÑ„Å™Èñ¢‰øÇÊÄß„ÇíË¶ã„Å§„Åë„Çà„ÅÜÔºÅ</p>

        <div class="stats">
            <div class="stat">
                <div class="stat-label">„Çπ„Ç≥„Ç¢</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">„É¨„Éô„É´</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">ÈÄ£Á∂öÊ≠£Ëß£</div>
                <div class="stat-value" id="streak">0</div>
            </div>
        </div>

        <div class="lives" id="lives">
            <span class="heart">‚ù§Ô∏è</span>
            <span class="heart">‚ù§Ô∏è</span>
            <span class="heart">‚ù§Ô∏è</span>
        </div>

        <div class="question-area" id="gameArea">
            <div class="numbers-display">
                <div class="number" id="num1">3</div>
                <div class="operator">?</div>
                <div class="number" id="num2">6</div>
            </div>
            <p class="question" id="question">„Åì„Çå„Çâ„ÅÆÊï∞Â≠ó„ÅÆÈñ¢‰øÇÊÄß„ÅØÔºü</p>
            <p class="hint" id="hint">„Éí„É≥„Éà: „ÅÇ„ÇãÊï∞Â≠¶ÁöÑ„Å™Ê≥ïÂâá</p>

            <div class="options" id="options"></div>
        </div>

        <button class="next-btn" id="nextBtn">Ê¨°„ÅÆÂïèÈ°å ‚Üí</button>

        <div class="game-over" id="gameOver">
            <h2>„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÔºÅ</h2>
            <p>ÊúÄÁµÇ„Çπ„Ç≥„Ç¢</p>
            <div class="final-score" id="finalScore">0</div>
            <p>Ê≠£Ëß£Êï∞: <span id="correctCount">0</span></p>
            <p>ÊúÄÈ´òÈÄ£Á∂öÊ≠£Ëß£: <span id="bestStreak">0</span></p>
            <button class="restart-btn" id="restartBtn">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
        </div>
    </div>

    <script>
        // Game state
        let state = {
            score: 0,
            level: 1,
            streak: 0,
            bestStreak: 0,
            lives: 3,
            correctCount: 0,
            currentQuestion: null,
            answered: false
        };

        // Question types
        const questionTypes = [
            {
                name: 'ÂÄçÊï∞',
                generate: () => {
                    const factor = Math.floor(Math.random() * 9) + 2;
                    const num1 = factor;
                    const num2 = factor * (Math.floor(Math.random() * 8) + 2);
                    return {
                        num1, num2,
                        question: `${num1} √ó ? = ${num2}`,
                        hint: 'ÂÄçÊï∞„ÅÆÈñ¢‰øÇ',
                        correct: num2 / num1,
                        options: generateOptions(num2 / num1, [
                            num2 / num1,
                            (num2 / num1) + 1,
                            (num2 / num1) - 1,
                            (num2 / num1) + 2
                        ].filter(x => x > 0 && Number.isInteger(x)))
                    };
                }
            },
            {
                name: 'Á¥ÑÊï∞',
                generate: () => {
                    const num = Math.floor(Math.random() * 20) + 10;
                    const divisors = [];
                    for (let i = 2; i <= Math.sqrt(num); i++) {
                        if (num % i === 0) {
                            divisors.push(i);
                            if (i !== num / i) divisors.push(num / i);
                        }
                    }
                    if (divisors.length < 2) return null;

                    const divisor = divisors[Math.floor(Math.random() * divisors.length)];
                    return {
                        num1: num,
                        num2: divisor,
                        question: `${num} „ÅÆÁ¥ÑÊï∞„ÅØÔºü`,
                        hint: 'Ââ≤„ÇäÂàá„Çå„ÇãÊï∞',
                        correct: divisor,
                        options: generateOptions(divisor, shuffleArray([
                            divisor,
                            divisor + 1,
                            divisor - 1,
                            divisor + 2
                        ].filter(x => x > 0)))
                    };
                }
            },
            {
                name: 'Á¥†Êï∞',
                generate: () => {
                    const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31];
                    const prime = primes[Math.floor(Math.random() * primes.length)];
                    const isPrime = Math.random() > 0.5;

                    return {
                        num1: prime,
                        num2: isPrime ? prime : prime + 1,
                        question: `${prime} „ÅØÁ¥†Êï∞Ôºü`,
                        hint: '1„Å®Ëá™ÂàÜËá™Ë∫´„Åß„Åó„ÅãÂâ≤„ÇäÂàá„Çå„Å™„ÅÑ',
                        correct: '„ÅØ„ÅÑ',
                        options: ['„ÅØ„ÅÑ', '„ÅÑ„ÅÑ„Åà']
                    };
                }
            },
            {
                name: 'Âπ≥ÊñπÊï∞',
                generate: () => {
                    const base = Math.floor(Math.random() * 10) + 2;
                    const square = base * base;
                    return {
                        num1: base,
                        num2: square,
                        question: `${base}¬≤ = ?`,
                        hint: 'Âπ≥ÊñπÊï∞ÔºàËá™‰πóÔºâ',
                        correct: square,
                        options: generateOptions(square, [
                            square,
                            square + 1,
                            square - 1,
                            square + 2
                        ])
                    };
                }
            },
            {
                name: '„Éï„Ç£„Éú„Éä„ÉÉ„ÉÅ',
                generate: () => {
                    const fib = [1, 1, 2, 3, 5, 8, 13, 21, 34];
                    const idx = Math.floor(Math.random() * (fib.length - 2));
                    return {
                        num1: fib[idx],
                        num2: fib[idx + 1],
                        question: `„Éï„Ç£„Éú„Éä„ÉÉ„ÉÅÊï∞Âàó„ÅÆÊ¨°„ÅØÔºü`,
                        hint: 'Ââç„ÅÆ2„Å§„ÅÆÊï∞„ÅÆÂíå',
                        correct: fib[idx + 2],
                        options: generateOptions(fib[idx + 2], [
                            fib[idx + 2],
                            fib[idx + 2] + 1,
                            fib[idx + 2] - 1,
                            fib[idx + 1] + fib[idx]
                        ])
                    };
                }
            },
            {
                name: 'Á¥Ø‰πó',
                generate: () => {
                    const base = Math.floor(Math.random() * 5) + 2;
                    const exp = Math.floor(Math.random() * 3) + 2;
                    const result = Math.pow(base, exp);
                    return {
                        num1: base,
                        num2: exp,
                        question: `${base}^${exp} = ?`,
                        hint: 'Á¥Ø‰πóÔºà„Åπ„Åç‰πóÔºâ',
                        correct: result,
                        options: generateOptions(result, [
                            result,
                            result + 1,
                            result - 1,
                            result * 2
                        ])
                    };
                }
            },
            {
                name: 'GCD',
                generate: () => {
                    const gcd = Math.floor(Math.random() * 8) + 2;
                    const a = gcd * (Math.floor(Math.random() * 5) + 1);
                    const b = gcd * (Math.floor(Math.random() * 5) + 1);
                    return {
                        num1: a,
                        num2: b,
                        question: `${a} „Å® ${b} „ÅÆÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞„ÅØÔºü`,
                        hint: 'ÂÖ±ÈÄö„ÅÆÁ¥ÑÊï∞„ÅÆ‰∏≠„ÅßÊúÄÂ§ß„ÅÆ„ÇÇ„ÅÆ',
                        correct: gcd,
                        options: generateOptions(gcd, shuffleArray([
                            gcd,
                            gcd + 1,
                            gcd - 1,
                            gcd * 2
                        ].filter(x => x > 0)))
                    };
                }
            }
        ];

        function generateOptions(correct, possible) {
            const options = [...new Set(possible)].slice(0, 4);
            while (options.length < 4) {
                const randomOffset = Math.floor(Math.random() * 10) - 5;
                const newVal = correct + randomOffset;
                if (newVal > 0 && !options.includes(newVal)) {
                    options.push(newVal);
                }
            }
            return shuffleArray(options).slice(0, 4);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function generateQuestion() {
            let attempts = 0;
            let question;

            do {
                const type = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                question = type.generate();
                attempts++;
            } while (!question && attempts < 10);

            return question;
        }

        function displayQuestion() {
            state.currentQuestion = generateQuestion();
            state.answered = false;

            if (!state.currentQuestion) {
                displayQuestion();
                return;
            }

            const q = state.currentQuestion;

            document.getElementById('num1').textContent = q.num1;
            document.getElementById('num2').textContent = q.num2 !== undefined ? q.num2 : '';
            document.getElementById('question').textContent = q.question;
            document.getElementById('hint').textContent = `„Éí„É≥„Éà: ${q.hint}`;

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option, btn);
                optionsContainer.appendChild(btn);
            });

            document.getElementById('nextBtn').classList.remove('visible');
        }

        function checkAnswer(answer, btn) {
            if (state.answered) return;
            state.answered = true;

            const correct = state.currentQuestion.correct;
            const isCorrect = answer == correct;

            if (isCorrect) {
                btn.classList.add('correct');
                state.score += 10 + (state.streak * 2);
                state.streak++;
                state.correctCount++;
                if (state.streak > state.bestStreak) {
                    state.bestStreak = state.streak;
                }
                showFeedback('‚úì', true);
            } else {
                btn.classList.add('wrong');
                state.streak = 0;
                state.lives--;
                updateLives();

                // Highlight correct answer
                const buttons = document.querySelectorAll('.option-btn');
                buttons.forEach(b => {
                    if (b.textContent == correct) {
                        b.classList.add('correct');
                    }
                });

                showFeedback('‚úó', false);

                if (state.lives <= 0) {
                    setTimeout(() => gameOver(), 1000);
                    return;
                }
            }

            // Level up every 5 correct answers
            if (state.correctCount % 5 === 0 && isCorrect) {
                state.level++;
            }

            updateStats();
            document.getElementById('nextBtn').classList.add('visible');
        }

        function showFeedback(text, isCorrect) {
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
            feedback.textContent = text;
            document.body.appendChild(feedback);

            setTimeout(() => {
                feedback.remove();
            }, 800);
        }

        function updateStats() {
            document.getElementById('score').textContent = state.score;
            document.getElementById('level').textContent = state.level;
            document.getElementById('streak').textContent = state.streak;
        }

        function updateLives() {
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach((heart, index) => {
                if (index < state.lives) {
                    heart.classList.remove('lost');
                } else {
                    heart.classList.add('lost');
                }
            });
        }

        function gameOver() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('gameOver').classList.add('visible');
            document.getElementById('finalScore').textContent = state.score;
            document.getElementById('correctCount').textContent = state.correctCount;
            document.getElementById('bestStreak').textContent = state.bestStreak;
        }

        function restartGame() {
            state = {
                score: 0,
                level: 1,
                streak: 0,
                bestStreak: 0,
                lives: 3,
                correctCount: 0,
                currentQuestion: null,
                answered: false
            };

            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('gameOver').classList.remove('visible');
            updateStats();
            updateLives();
            displayQuestion();
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', () => {
            displayQuestion();
        });

        document.getElementById('restartBtn').addEventListener('click', restartGame);

        document.getElementById('fullscreen').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // Initialize
        displayQuestion();
    </script>
</body>
</html>
