<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellular Automata - Life Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0e27;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            color: #00ff88;
            overflow: hidden;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 1200px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            }
            to {
                text-shadow: 0 0 30px rgba(0, 255, 136, 0.8), 0 0 40px rgba(0, 255, 136, 0.6);
            }
        }

        .subtitle {
            font-size: 1rem;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        canvas {
            border: 2px solid #00ff88;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            cursor: crosshair;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 10px 20px;
            min-width: 150px;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 10px 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 1000;
        }

        .fullscreen-btn:hover {
            background: rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
            transform: scale(1.1);
        }

        .patterns {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .pattern-btn {
            background: rgba(255, 136, 0, 0.2);
            border: 1px solid #ff8800;
            color: #ff8800;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pattern-btn:hover {
            background: rgba(255, 136, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.5);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            canvas {
                max-width: 100%;
            }

            .stat {
                min-width: 120px;
                padding: 8px 15px;
            }

            .stat-value {
                font-size: 1.2rem;
            }

            button {
                padding: 8px 15px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }

            .stats {
                gap: 15px;
            }

            .stat {
                min-width: 100px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="ÂÖ®ÁîªÈù¢Ë°®Á§∫">‚õ∂</button>

    <div class="container">
        <h1>üß¨ Cellular Automata</h1>
        <p class="subtitle">Conway's Game of Life - Click to add cells</p>

        <div class="stats">
            <div class="stat">
                <div class="stat-label">Generation</div>
                <div class="stat-value" id="generation">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Population</div>
                <div class="stat-value" id="population">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Status</div>
                <div class="stat-value" id="status">Paused</div>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
            <button onclick="togglePause()" id="pauseBtn">‚ñ∂ Start</button>
            <button onclick="step()">‚è≠ Step</button>
            <button onclick="randomize()">üé≤ Random</button>
            <button onclick="clearGrid()">üóë Clear</button>
        </div>

        <div class="patterns">
            <button class="pattern-btn" onclick="loadPattern('glider')">üöÄ Glider</button>
            <button class="pattern-btn" onclick="loadPattern('blinker')">‚ö° Blinker</button>
            <button class="pattern-btn" onclick="loadPattern('pulsar')">üí´ Pulsar</button>
            <button class="pattern-btn" onclick="loadPattern('gosper')">üî´ Gosper Gun</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Cell size and grid dimensions
        const cellSize = 15;
        let cols, rows;
        let grid = [];
        let generation = 0;
        let isRunning = false;
        let animationId = null;

        // Colors
        const colors = [
            '#00ff88',
            '#00ffcc',
            '#00ccff',
            '#88ff00',
            '#ffcc00'
        ];
        let colorIndex = 0;

        // Initialize canvas
        function initCanvas() {
            const maxWidth = Math.min(window.innerWidth - 40, 800);
            const maxHeight = Math.min(window.innerHeight - 350, 500);

            cols = Math.floor(maxWidth / cellSize);
            rows = Math.floor(maxHeight / cellSize);

            canvas.width = cols * cellSize;
            canvas.height = rows * cellSize;

            initializeGrid();
        }

        // Initialize grid
        function initializeGrid() {
            grid = [];
            for (let i = 0; i < cols; i++) {
                grid[i] = [];
                for (let j = 0; j < rows; j++) {
                    grid[i][j] = 0;
                }
            }
            generation = 0;
            updateStats();
        }

        // Randomize grid
        function randomize() {
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    grid[i][j] = Math.random() > 0.7 ? 1 : 0;
                }
            }
            generation = 0;
            updateStats();
            draw();
        }

        // Clear grid
        function clearGrid() {
            initializeGrid();
            draw();
        }

        // Count neighbors
        function countNeighbors(x, y) {
            let sum = 0;
            for (let i = -1; i < 2; i++) {
                for (let j = -1; j < 2; j++) {
                    const col = (x + i + cols) % cols;
                    const row = (y + j + rows) % rows;
                    sum += grid[col][row];
                }
            }
            sum -= grid[x][y];
            return sum;
        }

        // Update grid
        function update() {
            const nextGrid = [];
            for (let i = 0; i < cols; i++) {
                nextGrid[i] = [];
                for (let j = 0; j < rows; j++) {
                    const neighbors = countNeighbors(i, j);
                    const state = grid[i][j];

                    if (state === 0 && neighbors === 3) {
                        nextGrid[i][j] = 1;
                    } else if (state === 1 && (neighbors < 2 || neighbors > 3)) {
                        nextGrid[i][j] = 0;
                    } else {
                        nextGrid[i][j] = state;
                    }
                }
            }
            grid = nextGrid;
            generation++;
        }

        // Draw grid
        function draw() {
            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let population = 0;

            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    if (grid[i][j] === 1) {
                        population++;
                        const x = i * cellSize;
                        const y = j * cellSize;

                        // Gradient color based on position
                        const hue = (i + j + generation * 0.5) % 360;
                        ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                        ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
                        ctx.shadowBlur = 10;

                        ctx.fillRect(x + 1, y + 1, cellSize - 2, cellSize - 2);

                        ctx.shadowBlur = 0;
                    }
                }
            }

            document.getElementById('population').textContent = population;
            document.getElementById('generation').textContent = generation;
        }

        // Animation loop
        function animate() {
            if (isRunning) {
                update();
                draw();
                animationId = requestAnimationFrame(animate);
            }
        }

        // Toggle pause/play
        function togglePause() {
            isRunning = !isRunning;
            const btn = document.getElementById('pauseBtn');
            const status = document.getElementById('status');

            if (isRunning) {
                btn.textContent = '‚è∏ Pause';
                status.textContent = 'Running';
                animate();
            } else {
                btn.textContent = '‚ñ∂ Start';
                status.textContent = 'Paused';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        }

        // Step forward
        function step() {
            update();
            draw();
        }

        // Update stats
        function updateStats() {
            document.getElementById('generation').textContent = generation;
        }

        // Mouse click to add cells
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const col = Math.floor(x / cellSize);
            const row = Math.floor(y / cellSize);

            if (col >= 0 && col < cols && row >= 0 && row < rows) {
                grid[col][row] = grid[col][row] ? 0 : 1;
                draw();
            }
        });

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            const col = Math.floor(x / cellSize);
            const row = Math.floor(y / cellSize);

            if (col >= 0 && col < cols && row >= 0 && row < rows) {
                grid[col][row] = grid[col][row] ? 0 : 1;
                draw();
            }
        });

        // Load patterns
        function loadPattern(pattern) {
            clearGrid();
            const centerX = Math.floor(cols / 2);
            const centerY = Math.floor(rows / 2);

            if (pattern === 'glider') {
                const glider = [[0, -1], [1, 0], [-1, 1], [0, 1], [1, 1]];
                glider.forEach(([dx, dy]) => {
                    grid[centerX + dx][centerY + dy] = 1;
                });
            } else if (pattern === 'blinker') {
                for (let i = -1; i <= 1; i++) {
                    grid[centerX + i][centerY] = 1;
                }
            } else if (pattern === 'pulsar') {
                const pulsarCoords = [
                    [-6, -4], [-6, -3], [-6, -2],
                    [-4, -6], [-3, -6], [-2, -6],
                    [-4, -1], [-3, -1], [-2, -1],
                    [-1, -4], [-1, -3], [-1, -2],
                    [-1, 2], [-1, 3], [-1, 4],
                    [-4, 1], [-3, 1], [-2, 1],
                    [-4, 6], [-3, 6], [-2, 6],
                    [-6, 4], [-6, 3], [-6, 2],
                    [2, -4], [2, -3], [2, -2],
                    [4, -6], [3, -6], [2, -6],
                    [4, -1], [3, -1], [2, -1],
                    [1, -4], [1, -3], [1, -2],
                    [1, 2], [1, 3], [1, 4],
                    [4, 1], [3, 1], [2, 1],
                    [4, 6], [3, 6], [2, 6],
                    [2, 4], [2, 3], [2, 2],
                    [6, -4], [6, -3], [6, -2],
                    [6, -1], [6, 1],
                    [6, 2], [6, 3], [6, 4]
                ];
                pulsarCoords.forEach(([dx, dy]) => {
                    if (centerX + dx >= 0 && centerX + dx < cols && centerY + dy >= 0 && centerY + dy < rows) {
                        grid[centerX + dx][centerY + dy] = 1;
                    }
                });
            } else if (pattern === 'gosper') {
                const startX = centerX - 10;
                const startY = centerY - 5;
                const gosperGun = [
                    [24, 0], [22, 1], [24, 1], [12, 2], [13, 2], [20, 2], [21, 2], [34, 2], [35, 2],
                    [11, 3], [15, 3], [20, 3], [21, 3], [34, 3], [35, 3], [0, 4], [1, 4], [10, 4],
                    [16, 4], [20, 4], [21, 4], [0, 5], [1, 5], [10, 5], [14, 5], [16, 5], [17, 5],
                    [22, 5], [24, 5], [10, 6], [16, 6], [24, 6], [11, 7], [15, 7], [12, 8], [13, 8]
                ];
                gosperGun.forEach(([dx, dy]) => {
                    if (startX + dx >= 0 && startX + dx < cols && startY + dy >= 0 && startY + dy < rows) {
                        grid[startX + dx][startY + dy] = 1;
                    }
                });
            }

            draw();
        }

        // Fullscreen toggle
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Handle resize
        window.addEventListener('resize', () => {
            initCanvas();
            draw();
        });

        // Initialize
        initCanvas();
        draw();
    </script>
</body>
</html>
