<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quick Reaction</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        .color-box {
            width: 100%;
            height: 300px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            user-select: none;
        }
        .color-box:active {
            transform: scale(0.98);
        }
        .waiting {
            background: #e74c3c;
        }
        .ready {
            background: #2ecc71;
        }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn:active {
            transform: translateY(0);
        }
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        @media (max-width: 768px) {
            .game-container {
                padding: 30px 20px;
            }
            h1 {
                font-size: 1.5em;
            }
            .color-box {
                height: 250px;
                font-size: 20px;
            }
            .stat-value {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" onclick="toggleFullScreen()">â›¶</button>

    <div class="game-container">
        <h1>âš¡ Quick Reaction</h1>

        <!-- Start Screen -->
        <div class="screen active" id="startScreen">
            <div class="color-box waiting">
                <div>åå¿œé€Ÿåº¦ã‚’æ¸¬å®šã—ã¾ã™</div>
            </div>
            <p style="margin-bottom: 20px; color: #6c757d;">
                èµ¤è‰²ã‹ã‚‰ç·‘è‰²ã«å¤‰ã‚ã£ãŸç¬é–“ã«ã‚¿ãƒƒãƒ—ï¼<br>
                5å›è©¦è¡Œã—ã¦å¹³å‡ã‚’è¨˜éŒ²ã—ã¾ã™
            </p>
            <button class="btn" onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="gameScreen">
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">è©¦è¡Œå›æ•°</div>
                    <div class="stat-value" id="attempts">0/5</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">å‰å›ã®è¨˜éŒ²</div>
                    <div class="stat-value" id="lastTime">-</div>
                </div>
            </div>
            <div class="color-box" id="colorBox">
                <div id="boxText">å¾…æ©Ÿ...</div>
            </div>
        </div>

        <!-- Result Screen -->
        <div class="screen" id="resultScreen">
            <div class="color-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div>ğŸ‰ å®Œäº†ï¼</div>
            </div>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">å¹³å‡åå¿œæ™‚é–“</div>
                    <div class="stat-value" id="avgTime">0 ms</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ãƒ™ã‚¹ãƒˆè¨˜éŒ²</div>
                    <div class="stat-value" id="bestTime">0 ms</div>
                </div>
            </div>
            <p id="rank" style="margin-bottom: 20px; color: #6c757d; font-weight: bold;"></p>
            <button class="btn" onclick="startGame()">ã‚‚ã†ä¸€åº¦</button>
        </div>
    </div>

    <script>
        let gameState = 'waiting';
        let startTime = 0;
        let attempts = 0;
        const maxAttempts = 5;
        let reactionTimes = [];
        let bestTime = localStorage.getItem('bestReaction') || null;

        const colorBox = document.getElementById('colorBox');
        const boxText = document.getElementById('boxText');

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startGame() {
            attempts = 0;
            reactionTimes = [];
            showScreen('gameScreen');
            updateStats();
            prepareNextRound();
        }

        function prepareNextRound() {
            gameState = 'waiting';
            colorBox.className = 'color-box waiting';
            boxText.textContent = 'å¾…æ©Ÿä¸­...';
            colorBox.style.background = '#e74c3c';

            const delay = 2000 + Math.random() * 3000;
            setTimeout(() => {
                gameState = 'ready';
                startTime = Date.now();
                colorBox.className = 'color-box ready';
                boxText.textContent = 'ã‚¿ãƒƒãƒ—ï¼';
                colorBox.style.background = '#2ecc71';
            }, delay);
        }

        function handleClick() {
            if (gameState === 'waiting') {
                // æ—©ã™ãã‚‹
                gameState = 'failed';
                boxText.textContent = 'æ—©ã™ãï¼';
                colorBox.style.background = '#f39c12';
                setTimeout(() => {
                    prepareNextRound();
                }, 1000);
            } else if (gameState === 'ready') {
                const reactionTime = Date.now() - startTime;
                reactionTimes.push(reactionTime);
                attempts++;

                if (attempts >= maxAttempts) {
                    showResult();
                } else {
                    boxText.textContent = `${reactionTime} ms`;
                    updateStats();
                    setTimeout(() => {
                        prepareNextRound();
                    }, 1000);
                }
            }
        }

        function updateStats() {
            document.getElementById('attempts').textContent = `${attempts}/${maxAttempts}`;
            if (reactionTimes.length > 0) {
                const lastTime = reactionTimes[reactionTimes.length - 1];
                document.getElementById('lastTime').textContent = `${lastTime} ms`;
            }
        }

        function showResult() {
            const avgTime = Math.round(reactionTimes.reduce((a, b) => a + b, 0) / reactionTimes.length);
            const minTime = Math.min(...reactionTimes);

            document.getElementById('avgTime').textContent = `${avgTime} ms`;
            document.getElementById('bestTime').textContent = `${minTime} ms`;

            // ãƒ©ãƒ³ã‚¯åˆ¤å®š
            let rank = '';
            if (avgTime < 200) {
                rank = 'ğŸ† Sãƒ©ãƒ³ã‚¯ - è¶…äººçš„ï¼';
            } else if (avgTime < 250) {
                rank = 'ğŸ¥‡ Aãƒ©ãƒ³ã‚¯ - ç´ æ™´ã‚‰ã—ã„ï¼';
            } else if (avgTime < 300) {
                rank = 'ğŸ¥ˆ Bãƒ©ãƒ³ã‚¯ - ã„ã„èª¿å­ï¼';
            } else if (avgTime < 400) {
                rank = 'ğŸ¥‰ Cãƒ©ãƒ³ã‚¯ - æ™®é€šã§ã™';
            } else {
                rank = 'ğŸ’ª ã‚‚ã†å°‘ã—ç·´ç¿’ï¼';
            }
            document.getElementById('rank').textContent = rank;

            // ãƒ™ã‚¹ãƒˆè¨˜éŒ²æ›´æ–°
            if (!bestTime || minTime < bestTime) {
                bestTime = minTime;
                localStorage.setItem('bestReaction', bestTime);
            }

            showScreen('resultScreen');
        }

        colorBox.addEventListener('mousedown', handleClick);
        colorBox.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick();
        });

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('å…¨ç”»é¢ã‚¨ãƒ©ãƒ¼:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }
    </script>
</body>
</html>
