<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pattern Memory - „Éë„Çø„Éº„É≥Ë®òÊÜ∂„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            touch-action: manipulation;
        }

        .container {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #fff;
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 15px;
            color: #fff;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }

        .message {
            color: #fff;
            font-size: 18px;
            margin-bottom: 20px;
            min-height: 27px;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 0 auto 20px;
            max-width: 350px;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .cell:active {
            transform: scale(0.95);
        }

        .cell.active {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border-color: #00ff88;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        .cell.wrong {
            background: linear-gradient(135deg, #ff4757, #ff3344);
            border-color: #ff4757;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.5);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            margin-top: 10px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(102, 126, 234, 0.6);
        }

        .button:active {
            transform: translateY(0);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }

            .grid {
                gap: 8px;
                max-width: 300px;
            }

            .stat {
                padding: 10px 16px;
            }

            .stat-value {
                font-size: 20px;
            }

            .button {
                padding: 12px 30px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" onclick="toggleFullscreen()">ÂÖ®ÁîªÈù¢</button>

    <div class="container">
        <h1>üéÆ Pattern Memory</h1>

        <div class="stats">
            <div class="stat">
                <div class="stat-label">„É¨„Éô„É´</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">„Çπ„Ç≥„Ç¢</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">„Éô„Çπ„Éà</div>
                <div class="stat-value" id="best">0</div>
            </div>
        </div>

        <div class="message" id="message">„Çπ„Çø„Éº„Éà„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Å≠ÔºÅ</div>

        <div class="grid" id="grid">
            <!-- Cells will be generated by JavaScript -->
        </div>

        <button class="button" id="startBtn" onclick="startGame()">„Çπ„Çø„Éº„Éà</button>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const levelEl = document.getElementById('level');
        const scoreEl = document.getElementById('score');
        const bestEl = document.getElementById('best');
        const messageEl = document.getElementById('message');
        const startBtn = document.getElementById('startBtn');

        let pattern = [];
        let playerPattern = [];
        let level = 1;
        let score = 0;
        let bestScore = localStorage.getItem('patternMemoryBest') || 0;
        let isShowingPattern = false;
        let cells = [];

        bestEl.textContent = bestScore;

        // Create grid
        function createGrid() {
            grid.innerHTML = '';
            cells = [];
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.addEventListener('click', handleCellClick);
                grid.appendChild(cell);
                cells.push(cell);
            }
        }

        function handleCellClick(e) {
            if (isShowingPattern) return;

            const index = parseInt(e.target.dataset.index);
            e.target.classList.add('active');

            setTimeout(() => {
                e.target.classList.remove('active');
            }, 300);

            playerPattern.push(index);

            // Check if correct
            const currentIndex = playerPattern.length - 1;
            if (playerPattern[currentIndex] !== pattern[currentIndex]) {
                gameOver();
                return;
            }

            // Check if pattern complete
            if (playerPattern.length === pattern.length) {
                score += level * 10;
                scoreEl.textContent = score;
                level++;
                levelEl.textContent = level;
                messageEl.textContent = `Ê≠£Ëß£ÔºÅ „É¨„Éô„É´ ${level} „Å´ÊåëÊà¶ÔºÅ`;
                playerPattern = [];
                setTimeout(() => {
                    showPattern();
                }, 1000);
            }
        }

        function generatePattern() {
            const newPattern = [];
            const length = Math.min(2 + level, 9);
            const used = new Set();

            while (newPattern.length < length) {
                const index = Math.floor(Math.random() * 9);
                if (!used.has(index)) {
                    used.add(index);
                    newPattern.push(index);
                }
            }

            return newPattern;
        }

        async function showPattern() {
            isShowingPattern = true;
            startBtn.disabled = true;
            messageEl.textContent = '„Éë„Çø„Éº„É≥„ÇíË¶ö„Åà„Å¶„Å≠...';

            await sleep(500);

            for (let i = 0; i < pattern.length; i++) {
                await sleep(600 - Math.min(level * 20, 300));
                cells[pattern[i]].classList.add('active');
                await sleep(400);
                cells[pattern[i]].classList.remove('active');
            }

            messageEl.textContent = 'Âêå„ÅòÈ†ÜÁï™„Åß„Çø„ÉÉ„ÉóÔºÅ';
            isShowingPattern = false;
            playerPattern = [];
        }

        function startGame() {
            level = 1;
            score = 0;
            levelEl.textContent = level;
            scoreEl.textContent = score;
            pattern = generatePattern();
            playerPattern = [];
            startBtn.disabled = true;
            showPattern();
        }

        function gameOver() {
            messageEl.textContent = `„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÔºÅ „Çπ„Ç≥„Ç¢: ${score}`;

            if (score > bestScore) {
                bestScore = score;
                bestEl.textContent = bestScore;
                localStorage.setItem('patternMemoryBest', bestScore);
                messageEl.textContent = `üéâ Êñ∞Ë®òÈå≤ÔºÅ „Çπ„Ç≥„Ç¢: ${score}`;
            }

            // Show correct pattern
            pattern.forEach((index, i) => {
                setTimeout(() => {
                    cells[index].classList.add('active');
                    if (i === pattern.length - 1) {
                        setTimeout(() => {
                            cells.forEach(cell => cell.classList.remove('active'));
                        }, 1000);
                    }
                }, i * 200);
            });

            startBtn.disabled = false;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Initialize
        createGrid();
    </script>
</body>
</html>
