<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Rush - ÂèçÂ∞ÑÁ•ûÁµå„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        #gameCanvas {
            display: block;
            cursor: pointer;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .overlay h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .overlay p {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .overlay .score {
            font-size: 72px;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.7);
        }

        .btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            z-index: 50;
        }

        .hud div {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 101;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .overlay h1 {
                font-size: 32px;
            }

            .overlay .score {
                font-size: 48px;
            }

            .hud {
                font-size: 18px;
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .fullscreen-btn {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div class="hud">
        <div id="score">„Çπ„Ç≥„Ç¢: 0</div>
        <div id="time">ÊôÇÈñì: 30</div>
        <div id="combo"></div>
    </div>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">ÂÖ®ÁîªÈù¢</button>

    <div id="startOverlay" class="overlay">
        <h1>üé® Color Rush</h1>
        <p>Ë°®Á§∫„Åï„Çå„ÅüËâ≤„Å®Âêå„ÅòËâ≤„ÅÆ„Éú„Çø„É≥„Çí„Çø„ÉÉ„ÉóÔºÅ</p>
        <p>ÈÄ£Á∂öÊ≠£Ëß£„Åß„Ç≥„É≥„Éú„Éú„Éº„Éä„ÇπÔºÅ</p>
        <button class="btn" onclick="startGame()">„Çπ„Çø„Éº„Éà</button>
    </div>

    <div id="gameOverOverlay" class="overlay hidden">
        <h1>„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº</h1>
        <div class="score" id="finalScore">0</div>
        <p id="highScoreText">„Éè„Ç§„Çπ„Ç≥„Ç¢: 0</p>
        <button class="btn" onclick="startGame()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;

        // „Ç≤„Éº„É†Ë®≠ÂÆö
        const GAME_TIME = 30; // „Ç≤„Éº„É†ÊôÇÈñìÔºàÁßíÔºâ
        const COLORS = [
            { name: 'Ëµ§', value: '#ff4757', id: 'red' },
            { name: 'Èùí', value: '#3742fa', id: 'blue' },
            { name: 'Á∑ë', value: '#2ed573', id: 'green' },
            { name: 'ÈªÑ', value: '#ffa502', id: 'yellow' }
        ];

        let gameState = 'menu'; // menu, playing, gameover
        let score = 0;
        let timeLeft = GAME_TIME;
        let combo = 0;
        let highScore = parseInt(localStorage.getItem('colorRushHighScore')) || 0;

        let targetColor = null;
        let buttons = [];
        let particles = [];
        let lastTime = 0;
        let timerInterval = null;

        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇØ„É©„Çπ
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.vx = (Math.random() - 0.5) * 10;
                this.vy = (Math.random() - 0.5) * 10 - 5;
                this.size = Math.random() * 10 + 5;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.02;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.3; // ÈáçÂäõ
                this.life -= this.decay;
                this.size *= 0.98;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        // „Éú„Çø„É≥„ÇØ„É©„Çπ
        class ColorButton {
            constructor(color, x, y, size) {
                this.color = color;
                this.x = x;
                this.y = y;
                this.size = size;
                this.scale = 1;
                this.pulse = 0;
            }

            draw() {
                this.pulse += 0.05;
                const pulseScale = Math.sin(this.pulse) * 0.05;

                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.scale + pulseScale, this.scale + pulseScale);

                // „Éú„Çø„É≥ËÉåÊôØ
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color.value;
                ctx.fill();

                // ÂÖâ„ÇäÂäπÊûú
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.3)');
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = gradient;
                ctx.fill();

                // ÂΩ±
                ctx.shadowBlur = 20;
                ctx.shadowColor = this.color.value;
                ctx.fill();

                // Ëâ≤Âêç
                ctx.fillStyle = 'white';
                ctx.font = `bold ${this.size * 0.5}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.color.name, 0, 0);

                ctx.restore();

                // „Çπ„Ç±„Éº„É´„ÇíÊàª„Åô
                this.scale += (1 - this.scale) * 0.2;
            }

            isClicked(x, y) {
                const dist = Math.sqrt((x - this.x) ** 2 + (y - this.y) ** 2);
                return dist < this.size;
            }

            click() {
                this.scale = 1.2;
            }
        }

        function initGame() {
            // Êñ∞„Åó„ÅÑ„Çø„Éº„Ç≤„ÉÉ„ÉàËâ≤„ÇíÈÅ∏Êäû
            targetColor = COLORS[Math.floor(Math.random() * COLORS.length)];

            // „Éú„Çø„É≥„ÅÆ„Çµ„Ç§„Ç∫„Å®‰ΩçÁΩÆ
            const buttonSize = Math.min(width, height) * 0.15;
            const spacing = buttonSize * 1.5;

            buttons = [];
            COLORS.forEach((color, index) => {
                const row = Math.floor(index / 2);
                const col = index % 2;
                const x = width / 2 + (col - 0.5) * spacing;
                const y = height * 0.6 + row * spacing;
                buttons.push(new ColorButton(color, x, y, buttonSize));
            });

            particles = [];
        }

        function startGame() {
            gameState = 'playing';
            score = 0;
            timeLeft = GAME_TIME;
            combo = 0;

            document.getElementById('startOverlay').classList.add('hidden');
            document.getElementById('gameOverOverlay').classList.add('hidden');

            updateHUD();

            initGame();

            // „Çø„Ç§„Éû„ÉºÈñãÂßã
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameState === 'playing') {
                    timeLeft--;
                    updateHUD();

                    if (timeLeft <= 0) {
                        endGame();
                    }
                }
            }, 1000);

            lastTime = performance.now();
            gameLoop();
        }

        function endGame() {
            gameState = 'gameover';
            clearInterval(timerInterval);

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('colorRushHighScore', highScore);
            }

            document.getElementById('finalScore').textContent = score;
            document.getElementById('highScoreText').textContent = `„Éè„Ç§„Çπ„Ç≥„Ç¢: ${highScore}`;
            document.getElementById('gameOverOverlay').classList.remove('hidden');
        }

        function handleClick(x, y) {
            if (gameState !== 'playing') return;

            for (const button of buttons) {
                if (button.isClicked(x, y)) {
                    button.click();

                    if (button.color.id === targetColor.id) {
                        // Ê≠£Ëß£
                        combo++;
                        const baseScore = 100;
                        const comboBonus = Math.floor(combo * 10);
                        const timeBonus = Math.floor(timeLeft * 5);
                        score += baseScore + comboBonus + timeBonus;

                        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
                        for (let i = 0; i < 20; i++) {
                            particles.push(new Particle(x, y, button.color.value));
                        }

                        // Ê¨°„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà
                        targetColor = COLORS[Math.floor(Math.random() * COLORS.length)];
                    } else {
                        // ‰∏çÊ≠£Ëß£
                        combo = 0;
                        // „Éö„Éä„É´„ÉÜ„Ç£
                        score = Math.max(0, score - 50);

                        // ÈñìÈÅï„Å£„Åü„Éë„Éº„ÉÜ„Ç£„ÇØ„É´
                        for (let i = 0; i < 10; i++) {
                            particles.push(new Particle(x, y, '#333'));
                        }
                    }

                    updateHUD();
                    break;
                }
            }
        }

        function updateHUD() {
            document.getElementById('score').textContent = `„Çπ„Ç≥„Ç¢: ${score}`;
            document.getElementById('time').textContent = `ÊôÇÈñì: ${timeLeft}`;

            const comboEl = document.getElementById('combo');
            if (combo > 1) {
                comboEl.textContent = `üî• ${combo} „Ç≥„É≥„Éú!`;
                comboEl.style.opacity = '1';
            } else {
                comboEl.textContent = '';
            }
        }

        function gameLoop(timestamp = 0) {
            if (gameState !== 'playing') return;

            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;

            // „ÇØ„É™„Ç¢
            ctx.fillStyle = 'rgba(102, 126, 234, 0.2)';
            ctx.fillRect(0, 0, width, height);

            // „Çø„Éº„Ç≤„ÉÉ„ÉàËâ≤„ÇíË°®Á§∫
            ctx.save();
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // „Çø„Éº„Ç≤„ÉÉ„ÉàËâ≤„ÅÆËÉåÊôØ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.arc(width / 2, height * 0.25, 100, 0, Math.PI * 2);
            ctx.fill();

            // „Çø„Éº„Ç≤„ÉÉ„ÉàËâ≤
            ctx.fillStyle = targetColor.value;
            ctx.shadowBlur = 30;
            ctx.shadowColor = targetColor.value;
            ctx.font = 'bold 72px Arial';
            ctx.fillText(targetColor.name, width / 2, height * 0.25);

            // „Äå„Åì„Çå„Çí„Çø„ÉÉ„ÉóÔºÅ„Äç„ÉÜ„Ç≠„Çπ„Éà
            ctx.shadowBlur = 0;
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText('„Åì„Çå„Å®Âêå„ÅòËâ≤„Çí„Çø„ÉÉ„ÉóÔºÅ', width / 2, height * 0.35);
            ctx.restore();

            // „Éú„Çø„É≥„ÇíÊèèÁîª
            buttons.forEach(button => button.draw());

            // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÊõ¥Êñ∞„ÉªÊèèÁîª
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            requestAnimationFrame(gameLoop);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            handleClick(x, y);
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            handleClick(x, y);
        });

        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            if (gameState === 'playing') {
                initGame();
            }
        });

        // ÂàùÊúüÂåñ
        initGame();
    </script>
</body>
</html>
