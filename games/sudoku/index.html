<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Êï∞Áã¨„Éë„Ç∫„É´ - Sudoku</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .sudoku-container {
            background: #fff;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
            background: #333;
            border: 2px solid #333;
        }

        .cell {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            background: #fff;
            cursor: pointer;
            transition: all 0.15s ease;
            user-select: none;
        }

        .cell:hover {
            background: #f0f0f0;
        }

        .cell.selected {
            background: #bbdefb !important;
        }

        .cell.highlighted {
            background: #e3f2fd;
        }

        .cell.fixed {
            color: #333;
            background: #f5f5f5;
        }

        .cell.user-input {
            color: #1976d2;
        }

        .cell.error {
            background: #ffcdd2 !important;
            color: #c62828;
        }

        /* 3x3 box borders */
        .cell:nth-child(3n) {
            border-right: 2px solid #333;
        }

        .cell:nth-child(9n) {
            border-right: none;
        }

        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #333;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-width: 400px;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
        }

        .num-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .num-btn:hover {
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .num-btn:active {
            transform: translateY(0);
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-weight: bold;
            transition: all 0.15s ease;
        }

        .action-btn:hover {
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            backdrop-filter: blur(10px);
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .difficulty {
            margin-bottom: 15px;
        }

        .difficulty select {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.9);
        }

        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            z-index: 2000;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .message.show {
            display: block;
        }

        .message h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .message p {
            margin-bottom: 20px;
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @media (max-width: 400px) {
            .cell {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .num-btn {
                width: 45px;
                height: 45px;
            }

            h1 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <h1>üî¢ Êï∞Áã¨„Éë„Ç∫„É´</h1>
    <p class="subtitle">Sudoku Puzzle</p>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">ÂÖ®ÁîªÈù¢</button>

    <div class="difficulty">
        <select id="difficulty" onchange="newGame()">
            <option value="easy">Á∞°Âçò (Easy)</option>
            <option value="medium" selected>ÊôÆÈÄö (Medium)</option>
            <option value="hard">Èõ£„Åó„ÅÑ (Hard)</option>
        </select>
    </div>

    <div class="stats">
        <div class="stat">‚è±Ô∏è <span id="timer">00:00</span></div>
        <div class="stat">‚ùå <span id="mistakes">0</span>/3</div>
    </div>

    <div class="sudoku-container">
        <div class="sudoku-grid" id="grid"></div>
    </div>

    <div class="controls">
        <div class="number-pad" id="numberPad"></div>
        <button class="action-btn" onclick="eraseCell()">Ê∂àÂéª</button>
        <button class="action-btn" onclick="newGame()">Êñ∞Ë¶è</button>
        <button class="action-btn primary" onclick="checkSolution()">Á¢∫Ë™ç</button>
    </div>

    <div class="message" id="message">
        <h2 id="messageTitle"></h2>
        <p id="messageText"></p>
        <button class="action-btn primary" onclick="closeMessage()">OK</button>
    </div>

    <script>
        let board = [];
        let solution = [];
        let fixedCells = [];
        let selectedCell = null;
        let mistakes = 0;
        let timer = 0;
        let timerInterval = null;
        let gameActive = false;

        // Initialize the game
        function init() {
            createGrid();
            createNumberPad();
            newGame();
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 81; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.addEventListener('click', () => selectCell(i));
                grid.appendChild(cell);
            }
        }

        function createNumberPad() {
            const pad = document.getElementById('numberPad');
            pad.innerHTML = '';
            
            for (let i = 1; i <= 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'num-btn';
                btn.textContent = i;
                btn.addEventListener('click', () => enterNumber(i));
                pad.appendChild(btn);
            }

            // Erase button
            const eraseBtn = document.createElement('button');
            eraseBtn.className = 'num-btn';
            eraseBtn.textContent = '‚å´';
            eraseBtn.addEventListener('click', eraseCell);
            pad.appendChild(eraseBtn);
        }

        function generateSudoku() {
            // Start with a complete valid board
            solution = Array(81).fill(0);
            solveSudoku(solution);
            
            // Create puzzle by removing numbers
            const difficulty = document.getElementById('difficulty').value;
            const removeCount = { easy: 35, medium: 45, hard: 55 }[difficulty];
            
            board = [...solution];
            fixedCells = Array(81).fill(true);
            
            let removed = 0;
            const indices = Array.from({ length: 81 }, (_, i) => i);
            shuffleArray(indices);
            
            for (const index of indices) {
                if (removed >= removeCount) break;
                board[index] = 0;
                fixedCells[index] = false;
                removed++;
            }
        }

        function solveSudoku(grid) {
            const empty = grid.indexOf(0);
            if (empty === -1) return true;
            
            const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            shuffleArray(numbers);
            
            for (const num of numbers) {
                if (isValid(grid, empty, num)) {
                    grid[empty] = num;
                    if (solveSudoku(grid)) return true;
                    grid[empty] = 0;
                }
            }
            return false;
        }

        function isValid(grid, index, num) {
            const row = Math.floor(index / 9);
            const col = index % 9;
            
            // Check row
            for (let c = 0; c < 9; c++) {
                if (grid[row * 9 + c] === num) return false;
            }
            
            // Check column
            for (let r = 0; r < 9; r++) {
                if (grid[r * 9 + col] === num) return false;
            }
            
            // Check 3x3 box
            const boxRow = Math.floor(row / 3) * 3;
            const boxCol = Math.floor(col / 3) * 3;
            for (let r = boxRow; r < boxRow + 3; r++) {
                for (let c = boxCol; c < boxCol + 3; c++) {
                    if (grid[r * 9 + c] === num) return false;
                }
            }
            
            return true;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function newGame() {
            mistakes = 0;
            timer = 0;
            gameActive = true;
            selectedCell = null;
            
            updateMistakes();
            updateTimer();
            startTimer();
            
            generateSudoku();
            renderBoard();
        }

        function renderBoard() {
            const cells = document.querySelectorAll('.cell');
            
            cells.forEach((cell, i) => {
                cell.textContent = board[i] || '';
                cell.className = 'cell';
                
                if (fixedCells[i]) {
                    cell.classList.add('fixed');
                } else if (board[i]) {
                    cell.classList.add('user-input');
                }
            });
        }

        function selectCell(index) {
            if (!gameActive) return;
            
            const cells = document.querySelectorAll('.cell');
            
            // Clear previous selection
            cells.forEach(c => c.classList.remove('selected', 'highlighted'));
            
            selectedCell = index;
            cells[index].classList.add('selected');
            
            // Highlight related cells
            const row = Math.floor(index / 9);
            const col = index % 9;
            const boxRow = Math.floor(row / 3) * 3;
            const boxCol = Math.floor(col / 3) * 3;
            
            for (let i = 0; i < 81; i++) {
                const r = Math.floor(i / 9);
                const c = i % 9;
                const br = Math.floor(r / 3) * 3;
                const bc = Math.floor(c / 3) * 3;
                
                if (r === row || c === col || (br === boxRow && bc === boxCol)) {
                    if (i !== index) {
                        cells[i].classList.add('highlighted');
                    }
                }
            }
        }

        function enterNumber(num) {
            if (!gameActive || selectedCell === null || fixedCells[selectedCell]) return;
            
            const cells = document.querySelectorAll('.cell');
            
            // Check if the number is correct
            if (num !== solution[selectedCell]) {
                mistakes++;
                updateMistakes();
                
                cells[selectedCell].classList.add('error');
                setTimeout(() => {
                    cells[selectedCell].classList.remove('error');
                }, 500);
                
                if (mistakes >= 3) {
                    gameOver(false);
                    return;
                }
            } else {
                board[selectedCell] = num;
                cells[selectedCell].textContent = num;
                cells[selectedCell].classList.add('user-input');
                
                // Check if puzzle is complete
                if (board.every((val, i) => val === solution[i])) {
                    gameOver(true);
                }
            }
        }

        function eraseCell() {
            if (!gameActive || selectedCell === null || fixedCells[selectedCell]) return;
            
            board[selectedCell] = 0;
            const cells = document.querySelectorAll('.cell');
            cells[selectedCell].textContent = '';
            cells[selectedCell].classList.remove('user-input');
        }

        function checkSolution() {
            if (!gameActive) return;
            
            let isComplete = true;
            let hasErrors = false;
            
            for (let i = 0; i < 81; i++) {
                if (!board[i]) {
                    isComplete = false;
                } else if (board[i] !== solution[i]) {
                    hasErrors = true;
                }
            }
            
            if (hasErrors) {
                showMessage('„Éí„É≥„Éà', 'ÈñìÈÅï„Å£„ÅüÊï∞Â≠ó„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
            } else if (isComplete) {
                gameOver(true);
            } else {
                showMessage('È†ÜË™øÔºÅ', '‰ªä„ÅÆ„Å®„Åì„ÇçÊ≠£Ëß£„Åß„Åô„ÄÇÁ∂ö„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
            }
        }

        function gameOver(won) {
            gameActive = false;
            stopTimer();
            
            if (won) {
                showMessage('üéâ „ÇØ„É™„Ç¢ÔºÅ', `„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ\nÊôÇÈñì: ${formatTime(timer)}\n„Éü„Çπ: ${mistakes}`);
            } else {
                showMessage('üò¢ „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº', '„Éü„Çπ„Åå3Âõû„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
            }
        }

        function showMessage(title, text) {
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageText').textContent = text;
            document.getElementById('message').classList.add('show');
        }

        function closeMessage() {
            document.getElementById('message').classList.remove('show');
            if (!gameActive) {
                newGame();
            }
        }

        function updateMistakes() {
            document.getElementById('mistakes').textContent = mistakes;
        }

        function updateTimer() {
            document.getElementById('timer').textContent = formatTime(timer);
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            stopTimer();
            timerInterval = setInterval(() => {
                timer++;
                updateTimer();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Fullscreen error:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '9') {
                enterNumber(parseInt(e.key));
            } else if (e.key === 'Backspace' || e.key === 'Delete') {
                eraseCell();
            } else if (e.key.startsWith('Arrow')) {
                moveSelection(e.key);
            }
        });

        function moveSelection(key) {
            if (selectedCell === null) {
                selectCell(0);
                return;
            }
            
            const row = Math.floor(selectedCell / 9);
            const col = selectedCell % 9;
            let newRow = row;
            let newCol = col;
            
            switch (key) {
                case 'ArrowUp': newRow = Math.max(0, row - 1); break;
                case 'ArrowDown': newRow = Math.min(8, row + 1); break;
                case 'ArrowLeft': newCol = Math.max(0, col - 1); break;
                case 'ArrowRight': newCol = Math.min(8, col + 1); break;
            }
            
            selectCell(newRow * 9 + newCol);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
