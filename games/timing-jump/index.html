<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çø„Ç§„Éü„É≥„Ç∞„Ç∏„É£„É≥„Éó | Timing Jump</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
            touch-action: manipulation;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-container {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
        }

        .canvas-wrapper {
            position: relative;
            background: #1a1a2e;
            border-radius: 15px;
            overflow: hidden;
        }

        canvas {
            display: block;
            max-width: 100%;
            cursor: pointer;
        }

        .info-panel {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            transition: opacity 0.3s;
        }

        .overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .overlay h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .overlay p {
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .overlay .score {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            color: #feca57;
        }

        button {
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: none;
            cursor: pointer;
            font-size: 20px;
            z-index: 1000;
            transition: transform 0.2s;
        }

        .fullscreen-btn:hover {
            transform: scale(1.1);
        }

        .instructions {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            font-size: 0.9em;
            max-width: 400px;
        }

        .perfect-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: bold;
            color: #feca57;
            text-shadow: 0 0 20px rgba(254, 202, 87, 0.8);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.3s;
        }

        .perfect-indicator.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
        }

        @media (max-width: 600px) {
            h1 { font-size: 1.5em; }
            canvas { width: 100%; height: auto; }
        }
    </style>
</head>
<body>
    <h1>üéÆ „Çø„Ç§„Éü„É≥„Ç∞„Ç∏„É£„É≥„Éó</h1>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂</button>

    <div class="game-container">
        <div class="canvas-wrapper">
            <canvas id="canvas" width="600" height="400"></canvas>
            <div class="perfect-indicator" id="perfect">PERFECT!</div>

            <div class="overlay" id="startOverlay">
                <h2>üéÆ „Çø„Ç§„Éü„É≥„Ç∞„Ç∏„É£„É≥„Éó</h2>
                <p>ÂÆåÁíß„Å™„Çø„Ç§„Éü„É≥„Ç∞„Åß„Ç∏„É£„É≥„Éó„Åó„Å¶„Ç¥„Éº„É´„Å∏ÔºÅ</p>
                <button onclick="startGame()">‚ñ∂ „Çπ„Çø„Éº„Éà</button>
            </div>

            <div class="overlay hidden" id="gameOverlay">
                <h2>üéâ „Ç¥„Éº„É´ÔºÅ</h2>
                <div class="score" id="finalScore">0</div>
                <p>„Çπ„Ç≥„Ç¢</p>
                <button onclick="startGame()">üîÑ „ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
            </div>
        </div>

        <div class="info-panel">
            <div class="info-item">
                <div class="info-label">„Çπ„Ç≥„Ç¢</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">„É¨„Éô„É´</div>
                <div class="info-value" id="level">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">ÈÄ£Á∂öPerfect</div>
                <div class="info-value" id="combo">0</div>
            </div>
        </div>

        <div class="instructions">
            <strong>ÈÅä„Å≥Êñπ:</strong><br>
            ‚Ä¢ „Çø„ÉÉ„Éó/„ÇØ„É™„ÉÉ„ÇØ„Åß„Éú„Éº„É´„Çí„Ç∏„É£„É≥„Éó<br>
            ‚Ä¢ ÂÆåÁíß„Å™„Çø„Ç§„Éü„É≥„Ç∞„Åß„Ç¥„Éº„É´„ÇíÈÄöÈÅé<br>
            ‚Ä¢ ÈÄ£Á∂öPerfect„ÅßÈ´òÂæóÁÇπÔºÅ
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameState = 'start';
        let score = 0;
        let level = 1;
        let combo = 0;
        let maxCombo = 0;

        // Ball
        let ball = {
            x: 100,
            y: 200,
            vy: 0,
            radius: 15,
            isJumping: false,
            jumpPower: -12,
            gravity: 0.4
        };

        // Goal
        let goal = {
            x: 400,
            y: 200,
            width: 40,
            height: 80,
            passed: false,
            perfectWindow: 50
        };

        // Particles
        let particles = [];

        function resetGame() {
            ball.x = 100;
            ball.y = 200;
            ball.vy = 0;
            ball.isJumping = false;

            goal.x = 350 + Math.random() * 150;
            goal.y = 150 + Math.random() * 100;
            goal.passed = false;

            particles = [];
        }

        function startGame() {
            score = 0;
            level = 1;
            combo = 0;
            maxCombo = 0;

            document.getElementById('startOverlay').classList.add('hidden');
            document.getElementById('gameOverlay').classList.add('hidden');

            resetGame();
            gameState = 'playing';
            updateUI();
            gameLoop();
        }

        function jump() {
            if (gameState !== 'playing') return;
            if (!ball.isJumping) {
                ball.vy = ball.jumpPower;
                ball.isJumping = true;
            }
        }

        function update() {
            if (gameState !== 'playing') return;

            // Update ball
            ball.vy += ball.gravity;
            ball.y += ball.vy;

            // Ground collision
            if (ball.y > canvas.height - ball.radius) {
                ball.y = canvas.height - ball.radius;
                ball.vy = 0;
                ball.isJumping = false;

                // Reset if stuck on ground
                if (!goal.passed) {
                    resetGame();
                    combo = 0;
                    updateUI();
                }
            }

            // Ceiling collision
            if (ball.y < ball.radius) {
                ball.y = ball.radius;
                ball.vy = 0;
            }

            // Check goal passage
            const ballCenterY = ball.y;
            const goalTop = goal.y - goal.height / 2;
            const goalBottom = goal.y + goal.height / 2;
            const goalCenter = goal.y;

            if (!goal.passed && ball.x + ball.radius > goal.x - goal.width / 2) {
                const distanceFromCenter = Math.abs(ballCenterY - goalCenter);

                if (ballCenterY > goalTop && ballCenterY < goalBottom) {
                    goal.passed = true;

                    // Score based on accuracy
                    let accuracy = Math.max(0, 100 - (distanceFromCenter / goal.perfectWindow) * 100);

                    if (distanceFromCenter < goal.perfectWindow / 3) {
                        // Perfect!
                        combo++;
                        score += 100 * combo * level;
                        showPerfect();
                        createParticles(ball.x, ball.y, '#feca57');
                    } else if (distanceFromCenter < goal.perfectWindow) {
                        // Good
                        combo = Math.max(1, combo);
                        score += 50 * combo * level;
                        createParticles(ball.x, ball.y, '#ff6b6b');
                    } else {
                        // Okay
                        combo = 0;
                        score += 20 * level;
                    }

                    maxCombo = Math.max(maxCombo, combo);

                    // Next level
                    setTimeout(() => {
                        level++;
                        resetGame();
                        updateUI();
                    }, 1000);
                } else {
                    // Miss
                    combo = 0;
                    resetGame();
                    updateUI();
                }
            }

            // Update particles
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life--;
                return p.life > 0;
            });
        }

        function draw() {
            // Clear
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 30) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 30) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // Draw goal
            const goalGradient = ctx.createLinearGradient(
                goal.x - goal.width/2, 0,
                goal.x + goal.width/2, 0
            );
            goalGradient.addColorStop(0, '#ff6b6b');
            goalGradient.addColorStop(1, '#feca57');

            ctx.fillStyle = goalGradient;
            ctx.fillRect(
                goal.x - goal.width / 2,
                goal.y - goal.height / 2,
                goal.width,
                goal.height
            );

            // Goal glow
            ctx.shadowColor = '#feca57';
            ctx.shadowBlur = 20;
            ctx.strokeStyle = '#feca57';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                goal.x - goal.width / 2,
                goal.y - goal.height / 2,
                goal.width,
                goal.height
            );
            ctx.shadowBlur = 0;

            // Draw ball
            const ballGradient = ctx.createRadialGradient(
                ball.x - 5, ball.y - 5, 0,
                ball.x, ball.y, ball.radius
            );
            ballGradient.addColorStop(0, '#ffffff');
            ballGradient.addColorStop(0.5, '#48dbfb');
            ballGradient.addColorStop(1, '#0abde3');

            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = ballGradient;
            ctx.fill();

            // Ball glow
            ctx.shadowColor = '#48dbfb';
            ctx.shadowBlur = 15;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(72, 219, 251, 0.3)';
            ctx.fill();
            ctx.shadowBlur = 0;

            // Draw particles
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${p.r}, ${p.g}, ${p.b}, ${p.life / p.maxLife})`;
                ctx.fill();
            });

            // Draw trajectory hint
            if (!ball.isJumping && gameState === 'playing') {
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(ball.x, ball.y);

                let tempY = ball.y;
                let tempVy = ball.jumpPower;
                for (let i = 0; i < 30; i++) {
                    tempVy += ball.gravity;
                    tempY += tempVy;
                    ctx.lineTo(ball.x + i * 3, tempY);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function createParticles(x, y, color) {
            const colors = {
                '#feca57': { r: 254, g: 202, b: 87 },
                '#ff6b6b': { r: 255, g: 107, b: 107 },
                '#48dbfb': { r: 72, g: 219, b: 251 }
            };
            const c = colors[color] || colors['#48dbfb'];

            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    size: Math.random() * 4 + 2,
                    life: 30,
                    maxLife: 30,
                    r: c.r,
                    g: c.g,
                    b: c.b
                });
            }
        }

        function showPerfect() {
            const perfect = document.getElementById('perfect');
            perfect.classList.add('show');
            setTimeout(() => {
                perfect.classList.remove('show');
            }, 500);
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('combo').textContent = maxCombo;
        }

        function gameLoop() {
            if (gameState === 'playing') {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }

        // Event listeners
        canvas.addEventListener('click', jump);
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                if (gameState === 'playing') {
                    jump();
                }
            }
        });

        // Initial draw
        draw();
    </script>
</body>
</html>