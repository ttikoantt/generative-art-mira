<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Maze Runner - Generative Art by Mira</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Helvetica', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            text-align: center;
            padding: 20px;
        }

        h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats {
            color: white;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stats span {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        #gameCanvas {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin: 0 auto;
            display: block;
            max-width: 100%;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .instructions {
            color: white;
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.9;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            backdrop-filter: blur(5px);
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 22px;
            }

            .stats {
                font-size: 14px;
                gap: 10px;
            }

            button {
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" id="fullscreenBtn">å…¨ç”»é¢</button>

    <div class="container">
        <h1>ğŸ® Maze Runner</h1>

        <div class="stats">
            <span>â±ï¸ æ™‚é–“: <strong id="time">0</strong>ç§’</span>
            <span>ğŸ”¥ ãƒ¬ãƒ™ãƒ«: <strong id="level">1</strong></span>
        </div>

        <canvas id="gameCanvas" width="400" height="400"></canvas>

        <div class="controls">
            <button onclick="newGame()">ğŸ”„ æ–°ã—ã„è¿·è·¯</button>
            <button onclick="toggleSize()">ğŸ“ ã‚µã‚¤ã‚ºå¤‰æ›´</button>
        </div>

        <div class="instructions">
            â¬†ï¸â¬‡ï¸â¬…ï¸â¡ï¸ çŸ¢å°ã‚­ãƒ¼ã‹ã‚¹ãƒ¯ã‚¤ãƒ—ã§ç§»å‹•
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // è¨­å®š
        let mazeSize = 15;
        let cellSize;
        let maze = [];
        let player = { x: 0, y: 0 };
        let goal = { x: 0, y: 0 };
        let startTime;
        let level = 1;
        let timerInterval;
        let isSmall = true;

        // è¿·è·¯ç”Ÿæˆï¼ˆæ·±ã•å„ªå…ˆæ¢ç´¢ï¼‰
        function generateMaze(size) {
            // å…¨å£ã§åˆæœŸåŒ–
            maze = [];
            for (let y = 0; y < size; y++) {
                maze[y] = [];
                for (let x = 0; x < size; x++) {
                    maze[y][x] = 1; // 1 = å£
                }
            }

            // æ·±ã•å„ªå…ˆæ¢ç´¢
            const stack = [];
            const startX = 1;
            const startY = 1;
            maze[startY][startX] = 0;
            stack.push({ x: startX, y: startY });

            while (stack.length > 0) {
                const current = stack[stack.length - 1];
                const neighbors = [];

                // 2ã‚»ãƒ«å…ˆã®éš£æ¥ã‚»ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
                const directions = [
                    { dx: 0, dy: -2 }, // ä¸Š
                    { dx: 0, dy: 2 },  // ä¸‹
                    { dx: -2, dy: 0 }, // å·¦
                    { dx: 2, dy: 0 }   // å³
                ];

                for (const dir of directions) {
                    const nx = current.x + dir.dx;
                    const ny = current.y + dir.dy;

                    if (nx > 0 && nx < size - 1 && ny > 0 && ny < size - 1 && maze[ny][nx] === 1) {
                        neighbors.push({ x: nx, y: ny, dx: dir.dx, dy: dir.dy });
                    }
                }

                if (neighbors.length > 0) {
                    // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
                    const next = neighbors[Math.floor(Math.random() * neighbors.length)];
                    // å£ã‚’å–ã‚Šé™¤ã
                    maze[current.y + next.dy / 2][current.x + next.dx / 2] = 0;
                    maze[next.y][next.x] = 0;
                    stack.push({ x: next.x, y: next.y });
                } else {
                    stack.pop();
                }
            }

            return maze;
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            // è¿·è·¯ã‚µã‚¤ã‚ºã¯å¥‡æ•°ã«ã™ã‚‹
            if (mazeSize % 2 === 0) mazeSize++;

            cellSize = Math.floor(canvas.width / mazeSize);

            // è¿·è·¯ç”Ÿæˆ
            generateMaze(mazeSize);

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸä½ç½®
            player = { x: 1, y: 1 };

            // ã‚´ãƒ¼ãƒ«ä½ç½®
            goal = { x: mazeSize - 2, y: mazeSize - 2 };

            // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
            startTime = Date.now();
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);

            draw();
        }

        // æç”»
        function draw() {
            // èƒŒæ™¯ã‚¯ãƒªã‚¢
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // è¿·è·¯æç”»
            for (let y = 0; y < mazeSize; y++) {
                for (let x = 0; x < mazeSize; x++) {
                    if (maze[y][x] === 1) {
                        // å£
                        ctx.fillStyle = '#2c3e50';
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                    }
                }
            }

            // ã‚´ãƒ¼ãƒ«
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(
                goal.x * cellSize + cellSize / 2,
                goal.y * cellSize + cellSize / 2,
                cellSize / 3,
                0,
                Math.PI * 2
            );
            ctx.fill();

            // ã‚´ãƒ¼ãƒ«ãƒãƒ¼ã‚¯
            ctx.fillStyle = 'white';
            ctx.font = `${cellSize / 2}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸš©', goal.x * cellSize + cellSize / 2, goal.y * cellSize + cellSize / 2);

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.arc(
                player.x * cellSize + cellSize / 2,
                player.y * cellSize + cellSize / 2,
                cellSize / 3,
                0,
                Math.PI * 2
            );
            ctx.fill();

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é¡”
            ctx.fillStyle = 'white';
            ctx.font = `${cellSize / 2}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸ˜€', player.x * cellSize + cellSize / 2, player.y * cellSize + cellSize / 2);
        }

        // ç§»å‹•
        function move(dx, dy) {
            const newX = player.x + dx;
            const newY = player.y + dy;

            // å£ãƒã‚§ãƒƒã‚¯
            if (newX >= 0 && newX < mazeSize && newY >= 0 && newY < mazeSize && maze[newY][newX] === 0) {
                player.x = newX;
                player.y = newY;
                draw();

                // ã‚´ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
                if (player.x === goal.x && player.y === goal.y) {
                    level++;
                    document.getElementById('level').textContent = level;
                    setTimeout(() => {
                        alert(`ğŸ‰ ã‚¯ãƒªã‚¢ï¼\nãƒ¬ãƒ™ãƒ« ${level} ã«æŒ‘æˆ¦ï¼`);
                        initGame();
                    }, 100);
                }
            }
        }

        // ã‚­ãƒ¼æ“ä½œ
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    move(0, -1);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    move(0, 1);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    move(-1, 0);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    move(1, 0);
                    break;
            }
        });

        // ã‚¿ãƒƒãƒæ“ä½œï¼ˆã‚¹ãƒ¯ã‚¤ãƒ—ï¼‰
        let touchStartX = 0;
        let touchStartY = 0;

        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        canvas.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            const minSwipe = 30;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > minSwipe) move(1, 0);
                else if (dx < -minSwipe) move(-1, 0);
            } else {
                if (dy > minSwipe) move(0, 1);
                else if (dy < -minSwipe) move(0, -1);
            }
        });

        // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('time').textContent = elapsed;
        }

        // æ–°ã—ã„è¿·è·¯
        function newGame() {
            level = 1;
            document.getElementById('level').textContent = level;
            initGame();
        }

        // ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleSize() {
            isSmall = !isSmall;
            mazeSize = isSmall ? 15 : 21;
            canvas.width = isSmall ? 400 : 500;
            canvas.height = isSmall ? 400 : 500;
            initGame();
        }

        // å…¨ç”»é¢
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        });

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        initGame();
    </script>
</body>
</html>
