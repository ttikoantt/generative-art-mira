<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Word Chain - „Åó„Çä„Å®„Çä„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .emoji {
            text-align: center;
            font-size: 3em;
            margin-bottom: 20px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #f7f7f7;
            border-radius: 10px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.8em;
            color: #999;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .word-history {
            background: #f7f7f7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .word-history h3 {
            font-size: 0.9em;
            color: #999;
            margin-bottom: 10px;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .word-item {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .current-word {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            font-size: 2em;
            font-weight: bold;
            letter-spacing: 5px;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        #wordInput {
            flex: 1;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }

        #wordInput:focus {
            border-color: #667eea;
        }

        #submitBtn {
            padding: 15px 30px;
            font-size: 1.1em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #submitBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #submitBtn:active {
            transform: translateY(0);
        }

        #submitBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .message {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.95em;
            display: none;
        }

        .message.error {
            background: #fee;
            color: #c33;
            display: block;
        }

        .message.success {
            background: #efe;
            color: #3c3;
            display: block;
        }

        .message.info {
            background: #eef;
            color: #33c;
            display: block;
        }

        .hint {
            text-align: center;
            color: #999;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .hint span {
            color: #667eea;
            font-weight: bold;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1em;
            background: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn:hover {
            background: #e0e0e0;
        }

        .btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn.primary:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .emoji {
                font-size: 2.5em;
            }

            .current-word {
                font-size: 1.5em;
            }

            .input-wrapper {
                flex-direction: column;
            }

            #submitBtn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="emoji">üîó</div>
        <h1>Word Chain</h1>
        <p class="hint">Ââç„ÅÆÂçòË™û„ÅÆÊúÄÂæå„ÅÆÊñáÂ≠ó„ÅßÂßã„Åæ„ÇãÂçòË™û„ÇíÂÖ•ÂäõÔºà„Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„Éä„ÅÆ„ÅøÔºâ</p>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">ÂçòË™ûÊï∞</div>
                <div class="info-value" id="wordCount">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">Ê¨°„ÅÆÊñáÂ≠ó</div>
                <div class="info-value" id="nextChar">„Éº</div>
            </div>
        </div>

        <div class="current-word" id="currentWord">„Çä„Çì„Åî</div>

        <div class="word-history">
            <h3>ÂçòË™ûÂ±•Ê≠¥</h3>
            <div class="word-list" id="wordList"></div>
        </div>

        <div class="input-section">
            <div class="input-wrapper">
                <input type="text" id="wordInput" placeholder="ÂçòË™û„ÇíÂÖ•ÂäõÔºà‰æãÔºö„Åî„Çä„ÇâÔºâ" autocomplete="off">
                <button id="submitBtn">ÈÄÅ‰ø°</button>
            </div>
            <div class="message" id="message"></div>
        </div>

        <div class="buttons">
            <button class="btn" id="fullscreenBtn">ÂÖ®ÁîªÈù¢</button>
            <button class="btn primary" id="resetBtn">ÊúÄÂàù„Åã„Çâ</button>
        </div>
    </div>

    <script>
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let wordCount = 0;
        let currentWord = '„Çä„Çì„Åî';
        let wordHistory = [];

        // DOMË¶ÅÁ¥†
        const wordInput = document.getElementById('wordInput');
        const submitBtn = document.getElementById('submitBtn');
        const messageEl = document.getElementById('message');
        const wordCountEl = document.getElementById('wordCount');
        const nextCharEl = document.getElementById('nextChar');
        const currentWordEl = document.getElementById('currentWord');
        const wordListEl = document.getElementById('wordList');
        const resetBtn = document.getElementById('resetBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');

        // „Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„Éä„ÉÅ„Çß„ÉÉ„ÇØ
        function isHiraganaOrKatakana(text) {
            const hiragana = /^[\u3040-\u309F]+$/;
            const katakana = /^[\u30A0-\u30FF]+$/;
            return hiragana.test(text) || katakana.test(text);
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showMessage(text, type = 'info') {
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            setTimeout(() => {
                messageEl.className = 'message';
            }, 3000);
        }

        // „Ç≤„Éº„É†Áä∂ÊÖãÊõ¥Êñ∞
        function updateGameState() {
            wordCountEl.textContent = wordCount;
            currentWordEl.textContent = currentWord;

            // Ê¨°„ÅÆÊñáÂ≠ó„ÇíÂèñÂæó
            const lastChar = currentWord.slice(-1);
            nextCharEl.textContent = lastChar;

            // Â±•Ê≠¥„Å´ËøΩÂä†
            if (wordHistory.length === 0 || wordHistory[wordHistory.length - 1] !== currentWord) {
                wordHistory.push(currentWord);
                renderWordHistory();
            }
        }

        // Â±•Ê≠¥Ë°®Á§∫
        function renderWordHistory() {
            wordListEl.innerHTML = wordHistory.map(word => 
                `<div class="word-item">${word}</div>`
            ).join('');
        }

        // ÂçòË™û„ÉÅ„Çß„ÉÉ„ÇØ
        function validateWord(word) {
            // Á©∫„ÉÅ„Çß„ÉÉ„ÇØ
            if (!word || word.trim() === '') {
                return { valid: false, error: 'ÂçòË™û„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ' };
            }

            // „Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„Éä„ÉÅ„Çß„ÉÉ„ÇØ
            if (!isHiraganaOrKatakana(word)) {
                return { valid: false, error: '„Å≤„Çâ„Åå„Å™„Åã„Ç´„Çø„Ç´„Éä„ÅÆ„ÅøÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ' };
            }

            // „Äå„Çì„Äç„ÅßÁµÇ„Çè„Çã„ÉÅ„Çß„ÉÉ„ÇØ
            if (word.endsWith('„Çì') || word.endsWith('„É≥')) {
                return { valid: false, error: '„Äå„Çì„Äç„ÅßÁµÇ„Çè„ÇãÂçòË™û„ÅØ‰Ωø„Åà„Åæ„Åõ„Çì' };
            }

            // „Åô„Åß„Å´‰Ωø„Çè„Çå„ÅüÂçòË™û„ÉÅ„Çß„ÉÉ„ÇØ
            if (wordHistory.includes(word)) {
                return { valid: false, error: '„Åì„ÅÆÂçòË™û„ÅØ„Åô„Åß„Å´‰Ωø„Çè„Çå„Å¶„ÅÑ„Åæ„Åô' };
            }

            // „Åó„Çä„Å®„Çä„É´„Éº„É´„ÉÅ„Çß„ÉÉ„ÇØ
            const lastChar = currentWord.slice(-1);
            const firstChar = word[0];

            // Â∞èÊñáÂ≠ó„ÉªÊøÅÁÇπ„ÉªÂçäÊøÅÁÇπ„ÅÆÂá¶ÁêÜ
            const normalizeChar = (char) => {
                const smallToLarge = {
                    '„ÅÅ': '„ÅÇ', '„ÅÉ': '„ÅÑ', '„ÅÖ': '„ÅÜ', '„Åá': '„Åà', '„Åâ': '„Åä',
                    '„ÇÉ': '„ÇÑ', '„ÇÖ': '„ÇÜ', '„Çá': '„Çà', '„Çé': '„Çè',
                    '„Ç°': '„Ç¢', '„Ç£': '„Ç§', '„Ç•': '„Ç¶', '„Çß': '„Ç®', '„Ç©': '„Ç™',
                    '„É£': '„É§', '„É•': '„É¶', '„Éß': '„É®', '„ÉÆ': '„ÉØ'
                };

                const removeDakuten = (char) => {
                    const dakutenMap = {
                        '„Åå': '„Åã', '„Åé': '„Åç', '„Åê': '„Åè', '„Åí': '„Åí', '„Åî': '„Åî',
                        '„Åñ': '„Åï', '„Åò': '„Åó', '„Åö': '„Åô', '„Åú': '„Åõ', '„Åû': '„Åù',
                        '„Å†': '„Åü', '„Å¢': '„Å°', '„Å•': '„Å§', '„Åß': '„Å¶', '„Å©': '„Å©',
                        '„Å∞': '„ÅØ', '„Å≥': '„Å≤', '„Å∂': '„Åµ', '„Åπ': '„Å∏', '„Åº': '„Åª',
                        '„Å±': '„ÅØ', '„Å¥': '„Å≤', '„Å∑': '„Åµ', '„Å∫': '„Å∏', '„ÅΩ': '„Åª',
                        '„Ç¨': '„Ç´', '„ÇÆ': '„Ç≠', '„Ç∞': '„ÇØ', '„Ç≤': '„Ç±', '„Ç¥': '„Ç≥',
                        '„Ç∂': '„Çµ', '„Ç∏': '„Ç∑', '„Ç∫': '„Çπ', '„Çº': '„Çª', '„Çæ': '„ÇΩ',
                        '„ÉÄ': '„Çø', '„ÉÇ': '„ÉÅ', '„ÉÖ': '„ÉÑ', '„Éá': '„ÉÜ', '„Éâ': '„Éâ',
                        '„Éê': '„Éè', '„Éì': '„Éí', '„Éñ': '„Éï', '„Éô': '„Éò', '„Éú': '„Éõ',
                        '„Éë': '„Éè', '„Éî': '„Éí', '„Éó': '„Éï', '„Éö': '„Éò', '„Éù': '„Éõ'
                    };
                    return dakutenMap[char] || char;
                };

                let normalized = smallToLarge[char] || char;
                normalized = removeDakuten(normalized);
                return normalized;
            };

            const normalizedLast = normalizeChar(lastChar);
            const normalizedFirst = normalizeChar(firstChar);

            if (normalizedLast !== normalizedFirst) {
                return { valid: false, error: `„Äå${lastChar}„Äç„ÅßÂßã„Åæ„ÇãÂçòË™û„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ` };
            }

            return { valid: true };
        }

        // ÂçòË™ûÈÄÅ‰ø°
        function submitWord() {
            const word = wordInput.value.trim();

            if (!word) {
                showMessage('ÂçòË™û„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const validation = validateWord(word);

            if (!validation.valid) {
                showMessage(validation.error, 'error');
                wordInput.classList.add('error');
                setTimeout(() => wordInput.classList.remove('error'), 500);
                return;
            }

            // ÂçòË™û„ÇíÊé°Áî®
            currentWord = word;
            wordCount++;
            wordInput.value = '';
            showMessage('Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÊ¨°„ÅÆÂçòË™û„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„ÅôÔºÅ', 'success');
            updateGameState();
        }

        // „É™„Çª„ÉÉ„Éà
        function resetGame() {
            if (wordCount > 0 && !confirm('Êú¨ÂΩì„Å´ÊúÄÂàù„Åã„ÇâÂßã„ÇÅ„Åæ„Åô„ÅãÔºü')) {
                return;
            }

            wordCount = 0;
            currentWord = '„Çä„Çì„Åî';
            wordHistory = [];
            wordInput.value = '';
            updateGameState();
            showMessage('„Ç≤„Éº„É†„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü', 'info');
        }

        // ÂÖ®ÁîªÈù¢
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showMessage('ÂÖ®ÁîªÈù¢„É¢„Éº„Éâ„ÇíÈñãÂßã„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü', 'error');
                });
            } else {
                document.exitFullscreen();
            }
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        submitBtn.addEventListener('click', submitWord);

        wordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitWord();
            }
        });

        resetBtn.addEventListener('click', resetGame);
        fullscreenBtn.addEventListener('click', toggleFullscreen);

        // ÂàùÊúüÂåñ
        updateGameState();
        wordInput.focus();
    </script>
</body>
</html>
