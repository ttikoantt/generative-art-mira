<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Garden - ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«ãƒ»ã‚¬ãƒ¼ãƒ‡ãƒ³</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #0f0f23 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            color: #fff;
            z-index: 100;
            min-width: 200px;
        }

        .controls h1 {
            font-size: 1.2em;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #00ff88, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-size: 0.85em;
            margin-bottom: 5px;
            color: #aaa;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ff88, #00ffff);
            cursor: pointer;
        }

        .btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ff88, #00ffff);
            color: #000;
            font-weight: bold;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            color: #fff;
            font-size: 0.85em;
            text-align: right;
        }

        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 12px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9em;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .controls {
                top: 10px;
                left: 10px;
                padding: 15px;
                min-width: 160px;
            }

            .controls h1 {
                font-size: 1em;
            }

            .info {
                bottom: 80px;
                right: 10px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <canvas id="canvas"></canvas>

        <div class="controls">
            <h1>ğŸŒ± Fractal Garden</h1>

            <div class="control-group">
                <label>è¤‡é›‘ã•: <span id="complexityValue">8</span></label>
                <input type="range" id="complexity" min="4" max="12" value="8">
            </div>

            <div class="control-group">
                <label>åˆ†å²è§’åº¦: <span id="angleValue">25</span>Â°</label>
                <input type="range" id="angle" min="10" max="45" value="25">
            </div>

            <div class="control-group">
                <label>æã®é•·ã•: <span id="lengthValue">120</span></label>
                <input type="range" id="length" min="50" max="180" value="120">
            </div>

            <div class="control-group">
                <label>æˆé•·é€Ÿåº¦: <span id="speedValue">1.0</span>x</label>
                <input type="range" id="speed" min="0.5" max="3" step="0.1" value="1">
            </div>

            <button class="btn btn-primary" onclick="regenerate()">ğŸ”„ æ–°ã—ã„ã‚¬ãƒ¼ãƒ‡ãƒ³</button>
            <button class="btn btn-secondary" onclick="toggleAnimation()">â¯ï¸ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>

        <div class="info">
            <div>æ¤ç‰©: <span id="plantCount">0</span></div>
            <div>æã®ç·æ•°: <span id="branchCount">0</span></div>
            <div style="margin-top: 5px; font-size: 0.8em; color: #888;">
                å†å¸°çš„ãƒ•ãƒ©ã‚¯ã‚¿ãƒ«ã§è‡ªç„¶ãªæ¤ç‰©ã‚’ç”Ÿæˆ
            </div>
        </div>

        <button class="fullscreen-btn" onclick="toggleFullscreen()">â›¶ å…¨ç”»é¢è¡¨ç¤º</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let plants = [];
        let animationId;
        let isAnimating = true;
        let totalBranches = 0;

        // è¨­å®š
        let settings = {
            complexity: 8,
            angle: 25,
            length: 120,
            speed: 1
        };

        // è‰²å½©ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆè‡ªç„¶ãªæ¤ç‰©ã®è‰²ï¼‰
        const colorPalettes = [
            { trunk: '#8B4513', leaves: ['#228B22', '#32CD32', '#90EE90'] },
            { trunk: '#A0522D', leaves: ['#FF6347', '#FF7F50', '#FFA07A'] }, // èŠ±
            { trunk: '#654321', leaves: ['#9370DB', '#BA55D3', '#DDA0DD'] }, // ç´«
            { trunk: '#8B4513', leaves: ['#FFD700', '#FFA500', '#FF8C00'] }, // é»„è‰²
            { trunk: '#6B4423', leaves: ['#00CED1', '#40E0D0', '#7FFFD4'] }  // é’
        ];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function drawBranch(x, y, length, angle, depth, maxDepth, color, thickness) {
            if (depth > maxDepth) {
                // è‘‰ã‚„èŠ±ã‚’æç”»
                const leafSize = Math.random() * 8 + 4;
                const leafColor = color.leaves[Math.floor(Math.random() * color.leaves.length)];

                ctx.beginPath();
                ctx.arc(x, y, leafSize, 0, Math.PI * 2);
                ctx.fillStyle = leafColor;
                ctx.globalAlpha = 0.7;
                ctx.fill();
                ctx.globalAlpha = 1;

                totalBranches++;
                return;
            }

            const endX = x + Math.cos(angle) * length;
            const endY = y + Math.sin(angle) * length;

            // æã‚’æç”»
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = color.trunk;
            ctx.lineWidth = thickness;
            ctx.lineCap = 'round';
            ctx.stroke();

            totalBranches++;

            // å†å¸°çš„ã«åˆ†å²
            const newLength = length * (0.7 + Math.random() * 0.1);
            const newThickness = thickness * 0.7;
            const angleVariation = (settings.angle * Math.PI / 180) * (0.8 + Math.random() * 0.4);

            // 2ã¤ã«åˆ†å²
            drawBranch(
                endX, endY,
                newLength,
                angle - angleVariation,
                depth + 1,
                maxDepth,
                color,
                newThickness
            );

            drawBranch(
                endX, endY,
                newLength,
                angle + angleVariation,
                depth + 1,
                maxDepth,
                color,
                newThickness
            );

            // æ™‚ã€…3ã¤ç›®ã®æã‚’è¿½åŠ 
            if (Math.random() < 0.3 && depth > maxDepth / 3) {
                drawBranch(
                    endX, endY,
                    newLength * 0.8,
                    angle,
                    depth + 1,
                    maxDepth,
                    color,
                    newThickness * 0.8
                );
            }
        }

        function drawPlant(baseX, baseY, palette) {
            const plantHeight = settings.length * (0.8 + Math.random() * 0.4);
            const trunkThickness = 8 + Math.random() * 6;

            // å¹¹ã‹ã‚‰æˆé•·
            drawBranch(
                baseX, baseY,
                plantHeight,
                -Math.PI / 2, // ä¸Šæ–¹å‘
                0,
                settings.complexity,
                palette,
                trunkThickness
            );
        }

        function generateGarden() {
            plants = [];
            totalBranches = 0;

            // è¤‡æ•°ã®æ¤ç‰©ã‚’é…ç½®
            const numPlants = Math.floor(width / 150);

            for (let i = 0; i < numPlants; i++) {
                const x = (width / (numPlants + 1)) * (i + 1) + (Math.random() - 0.5) * 50;
                const y = height - 50 + (Math.random() - 0.5) * 20;
                const palette = colorPalettes[Math.floor(Math.random() * colorPalettes.length)];

                plants.push({ x, y, palette });
            }

            // ã‚¬ãƒ¼ãƒ‡ãƒ³ã‚’æç”»
            clearCanvas();
            plants.forEach(plant => {
                drawPlant(plant.x, plant.y, plant.palette);
            });

            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
            document.getElementById('plantCount').textContent = plants.length;
            document.getElementById('branchCount').textContent = totalBranches.toLocaleString();
        }

        function clearCanvas() {
            // èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(0.5, '#1a1a2e');
            gradient.addColorStop(1, '#0f0f23');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // åœ°é¢ã‚’æç”»
            ctx.beginPath();
            ctx.moveTo(0, height - 30);
            for (let x = 0; x <= width; x += 50) {
                ctx.lineTo(x, height - 30 + Math.sin(x * 0.02) * 10);
            }
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();

            const groundGradient = ctx.createLinearGradient(0, height - 30, 0, height);
            groundGradient.addColorStop(0, '#2d5016');
            groundGradient.addColorStop(1, '#1a3009');
            ctx.fillStyle = groundGradient;
            ctx.fill();
        }

        function animate() {
            if (!isAnimating) return;

            // å¾®ã‹ãªé¢¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
            const time = Date.now() * 0.001 * settings.speed;

            // ã‚†ã‚‰ãã‚’åŠ ãˆã¦å†æç”»
            clearCanvas();

            plants.forEach((plant, index) => {
                const windOffset = Math.sin(time + index * 0.5) * 0.02;
                plant.x += windOffset * 10;
                drawPlant(plant.x, plant.y, plant.palette);
                plant.x -= windOffset * 10;
            });

            animationId = requestAnimationFrame(animate);
        }

        function regenerate() {
            generateGarden();
        }

        function toggleAnimation() {
            isAnimating = !isAnimating;
            if (isAnimating) {
                animate();
            } else {
                cancelAnimationFrame(animationId);
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('complexity').addEventListener('input', (e) => {
            settings.complexity = parseInt(e.target.value);
            document.getElementById('complexityValue').textContent = settings.complexity;
        });

        document.getElementById('angle').addEventListener('input', (e) => {
            settings.angle = parseInt(e.target.value);
            document.getElementById('angleValue').textContent = settings.angle;
        });

        document.getElementById('length').addEventListener('input', (e) => {
            settings.length = parseInt(e.target.value);
            document.getElementById('lengthValue').textContent = settings.length;
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            settings.speed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = settings.speed.toFixed(1);
        });

        // åˆæœŸåŒ–
        window.addEventListener('resize', () => {
            resize();
            generateGarden();
        });

        resize();
        generateGarden();
        animate();

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¤‰æ›´æ™‚ã«å†ç”Ÿæˆ
        ['complexity', 'angle', 'length'].forEach(id => {
            document.getElementById(id).addEventListener('change', regenerate);
        });
    </script>
</body>
</html>
