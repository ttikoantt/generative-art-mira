<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ãƒ»ãƒãƒ³ãƒ€ãƒ© | Generative Mandala</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0f;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            max-width: 100%;
            max-height: 100vh;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 10;
            padding: 15px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-align: center;
            padding: 10px 20px;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .controls {
                width: 90%;
                top: 10px;
                padding: 10px;
            }

            button {
                padding: 8px 15px;
                font-size: 12px;
            }

            .info {
                width: 90%;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <canvas id="mandala"></canvas>
    </div>

    <div class="controls">
        <button onclick="regenerate()">ğŸ¨ æ–°ã—ã„ãƒãƒ³ãƒ€ãƒ©</button>
        <button onclick="toggleAnimation()">â¯ï¸ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</button>
        <button onclick="saveImage()">ğŸ’¾ ä¿å­˜</button>
    </div>

    <div class="info">
        ã‚¯ãƒªãƒƒã‚¯ã§æ–°ã—ã„ãƒãƒ³ãƒ€ãƒ©ã‚’ç”Ÿæˆ | ç„¡é™ã®å¯¾ç§°æ€§
    </div>

    <script>
        const canvas = document.getElementById('mandala');
        const ctx = canvas.getContext('2d');

        let width, height, centerX, centerY, minDim;
        let animating = true;
        let rotation = 0;
        let time = 0;

        // ãƒãƒ³ãƒ€ãƒ©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        let params = {};

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width * window.devicePixelRatio;
            canvas.height = height * window.devicePixelRatio;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

            centerX = width / 2;
            centerY = height / 2;
            minDim = Math.min(width, height);

            generateParams();
            draw();
        }

        function generateParams() {
            params = {
                segments: Math.floor(random(6, 16)),
                layers: Math.floor(random(3, 8)),
                baseRadius: minDim * 0.15,
                maxRadius: minDim * 0.42,
                hue1: random(0, 360),
                hue2: random(0, 360),
                lineWidth: random(1, 3),
                rotationSpeed: random(0.0005, 0.002) * (Math.random() > 0.5 ? 1 : -1),
                pulseSpeed: random(0.02, 0.05),
                shapes: ['circle', 'petal', 'star', 'spiral', 'wave'],
                blendModes: ['source-over', 'lighter', 'overlay', 'screen']
            };
        }

        function random(min, max) {
            return Math.random() * (max - min) + min;
        }

        function draw() {
            // èƒŒæ™¯ã‚’ã‚¯ãƒªã‚¢ï¼ˆæ®‹åƒåŠ¹æœãªã—ï¼‰
            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, width, height);

            time += 0.016;
            rotation += params.rotationSpeed;

            // ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            const pulse = 1 + Math.sin(time * params.pulseSpeed) * 0.05;

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(rotation);
            ctx.scale(pulse, pulse);

            // å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æç”»
            for (let i = 0; i < params.segments; i++) {
                ctx.save();
                ctx.rotate((Math.PI * 2 / params.segments) * i);

                for (let layer = 0; layer < params.layers; layer++) {
                    const layerRadius = params.baseRadius + (params.maxRadius - params.baseRadius) * (layer / (params.layers - 1));
                    const layerHue = (params.hue1 + (params.hue2 - params.hue1) * (layer / params.layers) + time * 10) % 360;

                    ctx.strokeStyle = `hsla(${layerHue}, 70%, 60%, 0.6)`;
                    ctx.fillStyle = `hsla(${layerHue}, 70%, 60%, 0.1)`;
                    ctx.lineWidth = params.lineWidth;
                    ctx.globalCompositeOperation = params.blendModes[layer % params.blendModes.length];

                    const shape = params.shapes[layer % params.shapes.length];
                    drawShape(shape, layerRadius, layer);
                }

                ctx.restore();
            }

            // ä¸­å¿ƒã®å…‰
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, params.baseRadius * 0.8);
            gradient.addColorStop(0, `hsla(${params.hue1}, 80%, 70%, 0.3)`);
            gradient.addColorStop(0.5, `hsla(${params.hue1}, 70%, 50%, 0.1)`);
            gradient.addColorStop(1, 'transparent');

            ctx.globalCompositeOperation = 'lighter';
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(0, 0, params.baseRadius * 0.8, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();

            if (animating) {
                requestAnimationFrame(draw);
            }
        }

        function drawShape(shape, radius, layer) {
            const detail = 3 + layer * 2;

            switch (shape) {
                case 'circle':
                    ctx.beginPath();
                    ctx.arc(0, radius * 0.8, radius * 0.3, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.fill();
                    break;

                case 'petal':
                    ctx.beginPath();
                    for (let i = 0; i <= detail; i++) {
                        const angle = (Math.PI / detail) * i;
                        const r = radius * (0.5 + Math.sin(angle * 3 + time) * 0.3);
                        const x = Math.sin(angle) * r;
                        const y = radius * 0.8 + Math.cos(angle) * r * 0.3;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                    ctx.stroke();
                    ctx.fill();
                    break;

                case 'star':
                    ctx.beginPath();
                    for (let i = 0; i <= detail * 2; i++) {
                        const angle = (Math.PI / detail) * i;
                        const r = i % 2 === 0 ? radius * 0.5 : radius * 0.2;
                        const x = Math.sin(angle) * r;
                        const y = radius * 0.8 + Math.cos(angle) * r;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                    ctx.stroke();
                    ctx.fill();
                    break;

                case 'spiral':
                    ctx.beginPath();
                    for (let i = 0; i <= 50; i++) {
                        const angle = (Math.PI * 2 / 50) * i;
                        const r = (radius * 0.1) + (radius * 0.4 / 50) * i;
                        const x = Math.sin(angle + time) * r;
                        const y = radius * 0.8 + Math.cos(angle + time) * r;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                    break;

                case 'wave':
                    ctx.beginPath();
                    for (let i = 0; i <= detail; i++) {
                        const angle = (Math.PI / detail) * i;
                        const r = radius * 0.5;
                        const wave = Math.sin(angle * 6 + time * 2) * radius * 0.15;
                        const x = Math.sin(angle) * (r + wave);
                        const y = radius * 0.8 + Math.cos(angle) * (r + wave);
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                    break;
            }
        }

        function regenerate() {
            generateParams();
            if (!animating) {
                draw();
            }
        }

        function toggleAnimation() {
            animating = !animating;
            if (animating) {
                draw();
            }
        }

        function saveImage() {
            const link = document.createElement('a');
            link.download = `mandala-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // ã‚¯ãƒªãƒƒã‚¯ã§æ–°ã—ã„ãƒãƒ³ãƒ€ãƒ©
        canvas.addEventListener('click', regenerate);

        // ã‚¿ãƒƒãƒã‚µãƒãƒ¼ãƒˆ
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            if (Math.abs(touchEndX - touchStartX) < 10) {
                regenerate();
            }
        });

        window.addEventListener('resize', resize);

        // åˆæœŸåŒ–
        resize();
    </script>
</body>
</html>
