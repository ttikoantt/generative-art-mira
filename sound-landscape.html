<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ãŒç´¡ãé¢¨æ™¯ - Sound Weaving Landscape</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            color: #e0e0e0;
            overflow: hidden;
        }

        .container {
            text-align: center;
            z-index: 10;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #7df9ff;
            text-shadow: 0 0 20px rgba(125, 249, 255, 0.5);
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .landscape-container {
            position: relative;
            width: 90vw;
            height: 60vh;
            margin: 2rem auto;
            border: 2px solid #3a3a6a;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3);
        }

        #landscape {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            line-height: 1.2;
            white-space: pre;
            color: #7df9ff;
            text-shadow: 0 0 5px currentColor;
        }

        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            background: rgba(125, 249, 255, 0.1);
            border: 2px solid #7df9ff;
            color: #7df9ff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            background: rgba(125, 249, 255, 0.3);
            box-shadow: 0 0 20px rgba(125, 249, 255, 0.5);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .info {
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #9a9aba;
            max-width: 600px;
        }

        .stats {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-top: 1rem;
            font-size: 0.85rem;
            color: #6a6aaa;
        }

        .particle {
            position: absolute;
            pointer-events: none;
            font-size: 20px;
            animation: float 3s ease-in-out infinite;
            opacity: 0.3;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .glow {
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { text-shadow: 0 0 5px currentColor; }
            50% { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ éŸ³ãŒç´¡ãé¢¨æ™¯ ğŸµ</h1>

        <div class="landscape-container">
            <div id="landscape"></div>
        </div>

        <div class="controls">
            <button id="playBtn">â–¶ å†ç”Ÿ</button>
            <button id="newPatternBtn">âœ¨ æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³</button>
            <button id="calmBtn">ğŸŒ™ é™å¯‚</button>
        </div>

        <div class="stats">
            <span id="noteStat">éŸ³: 0</span>
            <span id="patternStat">ãƒ‘ã‚¿ãƒ¼ãƒ³: æ£®</span>
        </div>

        <p class="info">
            éŸ³ãŒæ–‡å­—ã¨ãªã‚Šã€é¢¨æ™¯ã‚’æãã¾ã™ã€‚<br>
            å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€éŸ³æ¥½ãŒå§‹ã¾ã‚Šã€ASCIIã‚¢ãƒ¼ãƒˆãŒèˆã„å§‹ã‚ã¾ã™ã€‚
        </p>
    </div>

    <script>
        class SoundLandscape {
            constructor() {
                this.audioContext = null;
                this.isPlaying = false;
                this.notes = [];
                this.landscape = document.getElementById('landscape');
                this.width = 80;
                this.height = 40;
                this.grid = [];
                this.time = 0;
                this.patterns = {
                    forest: ['ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸ‹', 'ğŸƒ', 'âœ¿', 'â€'],
                    ocean: ['ğŸŒŠ', 'ğŸ’§', 'ğŸš', 'â­', 'ğŸŒŸ', 'âœ¨', 'ğŸ’«'],
                    city: ['ğŸ™ï¸', 'ğŸŒƒ', 'ğŸ†', 'âœ¨', 'ğŸ’¡', 'ğŸŒŸ', 'âš¡'],
                    abstract: ['â—†', 'â—‡', 'â—‹', 'â—', 'â–³', 'â–²', 'â˜†', 'âœ¦', 'âœ§', 'â‹']
                };
                this.currentPattern = 'abstract';
                this.melodyInterval = null;
                this.animationFrame = null;
                this.noteCount = 0;

                this.initGrid();
                this.setupControls();
                this.animate();
            }

            initGrid() {
                this.grid = [];
                for (let y = 0; y < this.height; y++) {
                    this.grid[y] = [];
                    for (let x = 0; x < this.width; x++) {
                        this.grid[y][x] = {
                            char: 'Â·',
                            intensity: 0,
                            hue: Math.random() * 60 + 160 // Cyan to Blue range
                        };
                    }
                }
            }

            setupControls() {
                document.getElementById('playBtn').addEventListener('click', () => this.togglePlay());
                document.getElementById('newPatternBtn').addEventListener('click', () => this.changePattern());
                document.getElementById('calmBtn').addEventListener('click', () => this.calm());
            }

            async initAudio() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            togglePlay() {
                if (this.isPlaying) {
                    this.stop();
                } else {
                    this.play();
                }
            }

            async play() {
                await this.initAudio();
                this.isPlaying = true;
                document.getElementById('playBtn').textContent = 'â¸ åœæ­¢';

                // Generate melody
                this.melodyInterval = setInterval(() => {
                    this.playNote();
                }, 150);
            }

            stop() {
                this.isPlaying = false;
                document.getElementById('playBtn').textContent = 'â–¶ å†ç”Ÿ';
                if (this.melodyInterval) {
                    clearInterval(this.melodyInterval);
                }
            }

            playNote() {
                if (!this.audioContext) return;

                // Generate a pleasant note
                const scale = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25];
                const frequency = scale[Math.floor(Math.random() * scale.length)] * (0.5 + Math.random());
                const duration = 0.3 + Math.random() * 0.5;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.value = frequency;

                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + duration);

                // Add note effect to landscape
                this.addNoteEffect(frequency);
                this.noteCount++;
                document.getElementById('noteStat').textContent = `éŸ³: ${this.noteCount}`;
            }

            addNoteEffect(frequency) {
                const x = Math.floor(Math.random() * this.width);
                const y = Math.floor(Math.random() * this.height);
                const radius = Math.floor(frequency / 50) + 2;

                // Create ripple effect
                for (let dy = -radius; dy <= radius; dy++) {
                    for (let dx = -radius; dx <= radius; dx++) {
                        const nx = x + dx;
                        const ny = y + dy;
                        if (nx >= 0 && nx < this.width && ny >= 0 && ny < this.height) {
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            if (distance <= radius) {
                                const intensity = 1 - (distance / radius);
                                this.grid[ny][nx].intensity = Math.max(
                                    this.grid[ny][nx].intensity,
                                    intensity
                                );
                                this.grid[ny][nx].hue = (frequency / 10) % 360;
                            }
                        }
                    }
                }
            }

            changePattern() {
                const patterns = Object.keys(this.patterns);
                const currentIndex = patterns.indexOf(this.currentPattern);
                this.currentPattern = patterns[(currentIndex + 1) % patterns.length];
                document.getElementById('patternStat').textContent = `ãƒ‘ã‚¿ãƒ¼ãƒ³: ${this.currentPattern}`;

                // Reset grid with new pattern
                this.initGrid();
            }

            calm() {
                this.initGrid();
                this.noteCount = 0;
                document.getElementById('noteStat').textContent = `éŸ³: 0`;
            }

            animate() {
                this.time += 0.02;
                this.updateGrid();
                this.render();
                this.animationFrame = requestAnimationFrame(() => this.animate());
            }

            updateGrid() {
                for (let y = 0; y < this.height; y++) {
                    for (let x = 0; x < this.width; x++) {
                        const cell = this.grid[y][x];

                        // Decay intensity
                        cell.intensity *= 0.98;

                        // Add ambient movement
                        if (cell.intensity < 0.1) {
                            const noise = Math.sin(x * 0.1 + this.time) * Math.cos(y * 0.1 + this.time * 0.7);
                            cell.intensity = Math.max(cell.intensity, (noise + 1) * 0.15);
                        }

                        // Update character based on intensity
                        if (cell.intensity > 0.7) {
                            cell.char = this.getRandomPatternChar();
                        } else if (cell.intensity > 0.4) {
                            cell.char = ['â–‘', 'â–’', 'â–“'][Math.floor(Math.random() * 3)];
                        } else {
                            cell.char = 'Â·';
                        }
                    }
                }
            }

            getRandomPatternChar() {
                const chars = this.patterns[this.currentPattern];
                return chars[Math.floor(Math.random() * chars.length)];
            }

            render() {
                let output = '';
                for (let y = 0; y < this.height; y++) {
                    for (let x = 0; x < this.width; x++) {
                        const cell = this.grid[y][x];
                        if (cell.intensity > 0.5 && cell.char.length > 0) {
                            output += `<span class="glow" style="color: hsl(${cell.hue}, 80%, 60%)">${cell.char}</span>`;
                        } else {
                            output += `<span style="opacity: ${cell.intensity}">${cell.char}</span>`;
                        }
                    }
                    if (y < this.height - 1) output += '\n';
                }
                this.landscape.innerHTML = output;
            }
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', () => {
            new SoundLandscape();
        });
    </script>
</body>
</html>
